###    Le variabili volumes sono mappate come - host_folder:container_folder
###    Correggere all'occorrenza i path per le cartelle sull'host ma lasciare inalterati i path sui container docker  

postgres:
  image: postgres:9.4

  volumes:
    - /opt/epas/db/data:/var/lib/postgresql/data
    - /etc/localtime:/etc/localtime:ro
    - /etc/timezone:/etc/timezone:ro
    - /opt/epas/backups/:/tmp:ro

  restart: always

nginx:

  image: jwilder/nginx-proxy:latest

  ports:
    - "80:80"
#    - "443:443"

  volumes:
    - /etc/localtime:/etc/localtime:ro
    - /etc/timezone:/etc/timezone:ro
    - /var/run/docker.sock:/tmp/docker.sock
#    - /opt/epas/certs/:/etc/nginx/certs

  restart: always

epas:

  image: docker-registry.services.iit.cnr.it/epas:latest

  volumes:
    - /opt/epas/logs:/home/epas/epas/logs
    - /opt/epas/attachments:/home/epas/epas/data/attachments
    - /opt/epas/backups:/home/epas/epas/backups
    - /etc/localtime:/etc/localtime:ro
    - /etc/timezone:/etc/timezone:ro

  environment:
    - VIRTUAL_HOST=localhost
    - TZ=Europe/Rome
#    - PROTOCOL=https                        # default: http -- Attiva l'utilizzo del protocollo HTTPS
#    - PERSEO_BASE=                          # default: http://perseo.devel.iit.cnr.it
#    - PERSEO_USER=                          # default:
#    - PERSEO_PASS=                          # default:
#    - URL_ATTESTATI=                        # default: https://attestati.rm.cnr.it/attestati/
#    - CERT_NAME=epas                        # default: valore specificato in VIRTUAL_HOST -- Specifica un nome diverso per i file del certificato SSL
#    - DB_HOST=                              # default: indirizzo assegnato al container postgres linkato
#    - DB_PORT=                              # default: 5432
#    - DB_NAME=                              # default: epas
#    - DB_USER=                              # default: postgres
#    - DB_PASS=                              # default: "non necessaria"
#    - SMTP_FROM=                            # default: epas@cnr.it
#    - SMTP_HOST=                            # default: smtp.cnr.it
#    - SMTP_PORT=                            # default: 587
#    - SMTP_CHANNEL=                         # default: starttls
#    - SMTP_USER=                            # default:
#    - SMTP_PASS=                            # default:
#    - SMTP_PROTOCOL=                        # default: smtp. (smtp, smtps)
#    - BACKUP_CRON=                          # default: disattivato. (utilizzare il format del crontab. Es. 0 0 * * *)
#    - LOG_LEVEL=                            # default: INFO
#    - LOG_ON_FILE=                          # default: false (true, false)
#    - JOBS_ACTIVE=false                     # default: true. Se impostato a false disabilita l'esecuzione di tutti i job
#    - OIL_ENABLED=true                      # default: false. Se impostato abilita l'invio delle segnalazioni ad OIL
#    - OIL_CATEGORIES                        # default: 4:epas. Specifica le categorie utilizzate in OIL. 
#                                                       La lista delle categorie è suddivisa da ",", il campo ":" è utilizzato invece
#                                                       come separatore tra l'id della categoria ed il nome visualizzato all'utente, 
#                                                       es.: 1:Registrazione Timbrature,2:Gestione Assenze,3:Gestione Competenze,4:Altro
#    - OIL_CATEGORIES_SELECTED               # default: 4. Questo default è dato dall'ambiente di test di OIL. 
#                                                       Contiene l'id della categoria da mostrare già selezionata all'utente finale. 
  links:
    - postgres

  restart: always
