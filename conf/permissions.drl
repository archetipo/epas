package security;
 
import security.PermissionCheck;
import models.Person;
import models.Office;
import models.UsersRolesOffices;
import models.Permission;

global models.User currentOperator;

/* i dipendenti possono: */
rule IsPerson
when
 $c: PermissionCheck(action in (
     	"TestDrools.youMustBeLoggedIn",
     	/* abilitate per il metodo, ristrette poi */
     	"TestDrools.youMustBe"
     	), target == null, granted == false)
 $u: User(person != null)
then
 $c.grant();
end


/* Ognugno puoi vedere solo i propri dati */
rule ViewPersonalData
when
 $o: Office()
 $uro: UsersRolesOffices(user == currentOperator) from $o.usersRolesOffices
 $p: Permission(description == "viewPerson") from $uro.role.permissions  
 $c: PermissionCheck(action in ("TestDrools.youMustBe"), target == $o, 
      granted == false)
then
 $c.grant();
end



/* Ognugno puoi vedere solo i propri dati */
rule ViewPersonalData2
when
 $o: Office(name == "IIT")
 /* $uro: UsersRolesOffices(user == currentOperator) from $o.usersRolesOffices */
 $c: PermissionCheck(action in ("TestDrools.youMustBe"), target == $o, granted == false)
then
 System.out.println( $o );
 $c.grant();
end