#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Gestione tipi orario'  /}

#{set 'moreStyles'}
  <style>
  	#table-wtt th, #table-wtt td {
  		max-width: 40px;
  	}
  	
  	#table-wtt input[type=number] {
  		max-width: 60px;
  	}
  	
  	#table-wtt td.item {
  		font-size: .9em;
  	}

  </style>
#{/set}

<div class="container-fluid">

	<div class="col-md-6">
	<div class="panel panel-info">
	  <div class="panel-heading">
	    <h3 class="panel-title">Tipi orario CNR</h3>
	  </div>
	  <div class="panel-body">
	    <table class="table table-hover">
	        <tr>
	          <th class="center">Descrizione</th>
	          <th class="center">Contratti attivi<br>attualmente associati</th>
	          <th class="center">Cambia orario<br>a tutti</th>
	        </tr>
		    #{list items:wttDefault, as:'wtt'}
		      <tr>
		        <td>
		          <a href="@{WorkingTimes.showWorkingTimeType(wtt.id)}" data-modal=".my-modal-large">
				    ${wtt.description}			    
				  </a>
		        </td>
		        <td class="center">
		          <a href="@{WorkingTimes.showContractWorkingTimeType(wtt.id, office.id)}" data-modal=".my-modal">
		            ${wtt.getAssociatedActiveContract(office.id).size()}
		    	  </a>    
		        </td>
		        <td class="center">
		          <a href="@{WorkingTimes.changeWorkingTimeTypeToAll(wtt.id, office.id)}" data-modal=".my-modal">
		            Cambia
		    	  </a>
		        </td>
		      </tr>	
		    #{/list}
		</table>
	  </div>
	</div>
	</div>
	
	<div class="col-md-6">
	  
	  <div class="center">
	  #{form action:@WorkingTimes.manageWorkingTime(), role:'form', class:'form-inline', 
	    method:'GET', autocomplete:'off',
	    'data-reload':'#results'}
	    
	       <div class="form-group">
	        <label class="hidden-xs hidden-sm" for="dip">Sede </label>
	        <select name="office.id" class="form-control" id="dip" onChange="javascript:this.form.submit()" >
	            #{list items:offices, as:'officeItem'}
	              <option value="${officeItem.id}" #{if officeItem.id.equals(office.id) } selected="selected" #{/if} >
	                ${officeItem.name}
	              </option>
	            #{/list}
	        </select>
	      </div>
	       
	      <button type="submit" class="btn btn-default">Invio</button>
	  #{/form}
      </div>
	
		<div class="panel panel-info">
		  <div class="panel-heading">
		    <h3 class="panel-title">Tipi Orario particolari attivi</h3>
		  </div>
		  <div class="panel-body">
		    <!-- lista -->
		    <table class="table table-condensed table-hover">
		        <tr>
		          <th>Descrizione</th>
		          <th class="center">Sede</th>
		          <th class="center">Contratti attivi<br>associati</th>
		          <th class="center">Contratti<br>associati<br>(storico)</th>
		          <th class="center">Cambia orario<br>a tutti</th>
		        </tr>
			    #{list items:wttAllowed, as:'wtt'}
			    #{if wtt.disabled == false }
			      <tr>
			        <td>
			          <a href="@{WorkingTimes.showWorkingTimeType(wtt.id)}" data-modal=".my-modal-large">
					    ${wtt.description}			    
					  </a>
			        </td>
			        <td  class="center">${wtt.office.name}</td>
			        <td  class="center">
			          <a href="@{WorkingTimes.showContractWorkingTimeType(wtt.id, office.id)}" data-modal=".my-modal">
			            ${wtt.getAssociatedActiveContract(office.id).size()}
			    	  </a>    
			    	  #{if wtt.getAssociatedActiveContract(office.id).size() == 0 }
			    	    <a href="@{WorkingTimes.toggleWorkingTimeTypeEnabled(wtt.id)}">
			    	      <i data-toggle="tooltip" data-placement="bottom" title="Disattiva tipo orario non associato ad alcun contratto attivo" class="fa fa-power-off"></i>
			    	    </a>
			    	  #{/if }
			    	  
			        </td>
			        <td  class="center">
			          ${wtt.getAssociatedContract().size()}
			          #{if wtt.getAssociatedContract().size() == 0 }
			    	    <a href="@{WorkingTimes.delete(wtt.id)}">
			    	      <i data-toggle="tooltip" data-placement="bottom" title="Elimina tipo orario non associato ad alcun contratto" class="fa fa-trash-o"></i>
			    	    </a>
			    	  #{/if}
			    	</td>
			        <td class="center">
			          <a href="@{WorkingTimes.changeWorkingTimeTypeToAll(wtt.id, office.id)}" data-modal=".my-modal">
		                Cambia
		    	      </a>
					</td>
			      </tr>	
			    #{/if }  
			    #{/list}
			</table>
			
			<!-- Nuovo -->
			<a href="@{WorkingTimes.insertWorkingTime(office.id)}" data-modal=".my-modal-large">
		      <span class="glyphicon glyphicon-plus"></span> Crea nuovo orario di lavoro per ${office.name}
		    </a>
		  </div>
		</div>
	</div>
	
	<div class="col-md-6">
	<div class="panel-group" id="accordion-wtt">
	  <div class="panel panel-default">
	    <div class="panel-heading">
	      <h4 class="panel-title">
	        <a data-toggle="collapse" data-parent="#accordion-wtt" href="#collapseOne-wtt">
	          Tipi Orario particolari disattivati
	        </a>
	      </h4>
	    </div>
	    <div id="collapseOne-wtt" class="panel-collapse collapse out">
	      <div class="panel-body">
		    <!-- lista -->
		    <table class="table table-condensed table-hover">
		        <tr>
		          <th>Descrizione</th>
		          <th class="center">Sede</th>
		          <th class="center">Riattiva</th>
		          <th class="center">Contratti<br>associati<br>(storico)</th>
		        </tr>
			    #{list items:wttAllowed, as:'wtt'}
			    #{if wtt.disabled == true }
			      <tr>

			        <td>
			          <a href="@{WorkingTimes.showWorkingTimeType(wtt.id)}" data-modal=".my-modal-large">
					    ${wtt.description}			    
					  </a>
			        </td>

			        <td class="center">${wtt.office.name}</td>

			        <td class="center">
			          <a href="@{WorkingTimes.toggleWorkingTimeTypeEnabled(wtt.id)}">
			    	    <i data-toggle="tooltip" data-placement="bottom" title="Riattiva tipo orario" class="fa fa-power-off"></i>
			    	  </a>
			        </td>

			        <td  class="center">
			          ${wtt.getAssociatedContract().size()}
			          #{if wtt.getAssociatedContract().size() == 0 }
			    	    <a href="@{WorkingTimes.delete(wtt.id)}">
			    	      <i data-toggle="tooltip" data-placement="bottom" title="Elimina tipo orario non associato ad alcun contratto" class="fa fa-trash-o"></i>
			    	    </a>
			    	  #{/if}
			    	</td>
			      </tr>	
			    #{/if }  
			    #{/list}
			</table>
			
		  </div>
		</div>
      </div>
	</div>
	</div>

</div>

<div class="container">	

	<div class="well">
		<p class="text-danger"><strong><em>Importante</em></strong></p>
		Per motivi di sicurezza e integrità dei dati calcolati in ePAS non viene permessa la modifica diretta dei tipi orario.
		La procedura corretta per modificare il tipo orario è la seguente:
		<ul>
		 <li>Individuare il tipo orario da modificare (es <em>Normale</em>)</li>
		 <li>Creare un nuovo tipo orario con le modifiche opportune rispetto al tipo orario da modificare (es <em>Normale-mod</em>)</li>
		 <li>Attraverso la Form <strong>Cambia orario a tutti</strong> impostare la data (anche passata) a partire dalla quale tutti coloro che hanno impostato
		  il vecchio orario (<em>Normale</em>) vengano migrati al nuovo orario (<em>Normale-mod</em>)</li>
		 <li>Poichè il software provvederà ad effettuare nuovamente tutti i calcoli inerenti tempo lavorato e situazioni residuali 
		per ogni contratto attivo interessato dall'operazione a partire dalla data specificata, questa procedura potrebbe richiedere alcuni minuti.</li>
		</ul>
		
		
		<p><strong class="text-danger"><em>Modifiche per singoli dipendenti</em></strong><br>
		Nel caso di modifiche del tipo orario riguardanti un numero ristretto di dipendenti si consiglia di utilizzare le procedure messe a disposizione
		nella sezione amministrativa Lista Persone.
		</p>
		<p><strong class="text-danger"><em>Eliminare o disabilitare tipi orario</em></strong><br>
		Per eliminare un tipo orario è necessario che non sia associato ad alcun contratto presente in ePAS (anche terminato).<br>
		Per disabilitare un tipo orario è necessario che non sia attualmente associato ad alcun contratto attivo.
		</p>  
	</div>
	
	
	
</div>
	



#{include '_myModal_large.html' /}
#{include '_myModal.html' /}
