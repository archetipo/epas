#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Gestione tipi orario'  /}

#{set 'moreStyles'}
  <style>
  	#table-wtt th, #table-wtt td {
  		max-width: 40px;
  	}
  	
  	#table-wtt input[type=number] {
  		max-width: 60px;
  	}
  	
  	#table-wtt td.item {
  		font-size: .9em;
  	}

  </style>
#{/set}

#{panel title:'Tipi orario CNR', dim:6, offset:3, fluid:true, color:'success'}
  	
  	<div class="alert alert-success" role="alert">
   	  I <strong>tipi orario predefiniti</strong> possono essere assegnati ad ogni dipendente di ogni sede.<br>
   	  Non possono essere modificati o aggiunti ma possono essere presi ad esempio da parte degli amministratori
   	  del personale per creare nuovi tipi orario particolari per le sedi amministrate. 
   </div>
  
    <table class="table table-hover">
      <tr>
         <th class="center">Descrizione</th>
         <th class="center">Contratti attivi<br>attualmente associati<br>(alla data di oggi)</th>
         <th class="center">Periodi associati<br>a contratti attivi</th> 
         <th class="center">Cambia orario<br>a tutti</th>
      </tr>
      #{list items:wttDefault, as:'wtt'}
      <tr>
        <td>
          <a href="@{WorkingTimes.showWorkingTimeType(wtt.value.id)}" data-modal=".my-modal-large">
		    ${wtt.value.description}			    
		  </a>
        </td>
        <td class="center">
          <a href="@{WorkingTimes.showContract(wtt.value.id, office.id)}" data-modal=".my-modal">
            ${wtt.getAssociatedActiveContract(office.id).size()}
    	  </a>    
        </td>
        <td class="center">
          <a href="@{WorkingTimes.showContractWorkingTimeType(wtt.value.id, office.id)}" data-modal=".my-modal">
            ${wtt.getAssociatedPeriodInActiveContract(office.id).size()}
          </a>
        </td>
        <td class="center">
          <a href="@{WorkingTimes.changeWorkingTimeTypeToAll(wtt.value.id, office.id)}" data-modal=".my-modal">
            Cambia
    	  </a>
        </td>
       </tr>	
       #{/list}
	</table>
  #{/panel}

	<div class="container-fluid">
 <div class="center" style="margin-top: 0px; margin-bottom: 10px;">
	  #{form action:@WorkingTimes.manageWorkingTime(), role:'form', class:'form-inline', 
	    method:'GET', autocomplete:'off',
	    'data-reload':'#results'}
	    
	       <div class="form-group">
	        <label class="hidden-xs hidden-sm" for="dip">Sede </label>
	        <select name="officeId" class="form-control" id="dip" onChange="javascript:this.form.submit()" >
	            #{list items:offices, as:'officeItem'}
	              <option value="${officeItem.id}" #{if officeItem.id.equals(office.id) } selected="selected" #{/if} >
	                ${officeItem.name}
	              </option>
	            #{/list}
	        </select>
	      </div>
	       
	      <button type="submit" class="btn btn-default">Invio</button>
	  #{/form}
      </div>
</div>
	
  #{panel title:'Tipi Orario particolari per ' + office.name, dim:6, offset:3, fluid:true}
  
   <!-- Nuovo -->
			<a href="@{WorkingTimes.insertWorkingTime(office.id)}" data-modal=".my-modal-large">
		      <span class="glyphicon glyphicon-plus"></span> Crea nuovo orario di lavoro per ${office.name}
		    </a>
  
   <h4>Attivi</h4>
		    <table class="table table-condensed table-hover">
		        <tr>
		          <th>Descrizione</th>
		          <th class="center">Contratti attivi<br>attualmente associati</th>
		          <th class="center">Periodi associati<br>a contratti attivi</th> 
		          <th class="center">Contratti<br>associati<br>(storico)</th>
		          <th class="center">Cambia orario<br>a tutti</th>
		        </tr>
			    #{list items:wttAllowed, as:'wtt'}
			    #{if wtt.value.disabled == false }
			      <tr>
			        <td>
			          <a href="@{WorkingTimes.showWorkingTimeType(wtt.value.id)}" data-modal=".my-modal-large">
					    ${wtt.value.description}			    
					  </a>
			        </td>
			        
			        <!-- contratti attualmente attivi con wtt -->
			        <td  class="center">
			          <a href="@{WorkingTimes.showContract(wtt.value.id, office.id)}" data-modal=".my-modal">
			            ${wtt.getAssociatedActiveContract(office.id).size()}
			    	  </a>    
			    	  #{if wtt.getAssociatedActiveContract(office.id).size() == 0 }
			    	    <a href="@{WorkingTimes.toggleWorkingTimeTypeEnabled(wtt.value.id)}">
			    	      <i data-toggle="tooltip" data-placement="bottom" title="Disattiva tipo orario non associato ad alcun contratto attivo" class="fa fa-power-off"></i>
			    	    </a>
			    	  #{/if }
			        </td>
			        
			        <!-- periodi associati a contratti attualmente attivi con wtt -->
			        <td class="center">
		                <a href="@{WorkingTimes.showContractWorkingTimeType(wtt.value.id, office.id)}" data-modal=".my-modal">
		                  ${wtt.getAssociatedPeriodInActiveContract(office.id).size()}
		                </a>
			        </td>
			        
			        <!-- contratti associati con wtt (storico) -->
			        <td class="center">
			          ${wtt.getAssociatedContract().size()}
			          #{if wtt.getAssociatedContract().size() == 0 }
			    	    <a href="@{WorkingTimes.delete(wtt.value.id)}">
			    	      <i data-toggle="tooltip" data-placement="bottom" title="Elimina tipo orario non associato ad alcun contratto" class="fa fa-trash-o"></i>
			    	    </a>
			    	  #{/if}
			    	</td>
			        <td class="center">
			          <a href="@{WorkingTimes.changeWorkingTimeTypeToAll(wtt.value.id, office.id)}" data-modal=".my-modal">
		                Cambia
		    	      </a>
					</td>
			      </tr>	
			    #{/if }  
			    #{/list}
			</table>
			
			
		<h4>Disabilitati</h4>

		    <table class="table table-condensed table-hover">
		        <tr>
		          <th>Descrizione</th>
		          <th class="center">Sede</th>
		          <th class="center">Riattiva</th>
		          <th class="center">Contratti<br>associati<br>(storico)</th>
		        </tr>
			    #{list items:wttAllowed, as:'wtt'}
			    #{if wtt.value.disabled == true }
			      <tr>

			        <td>
			          <a href="@{WorkingTimes.showWorkingTimeType(wtt.value.id)}" data-modal=".my-modal-large">
					    ${wtt.value.description}			    
					  </a>
			        </td>

			        <td class="center">${wtt.value.office.name}</td>

			        <td class="center">
			          <a href="@{WorkingTimes.toggleWorkingTimeTypeEnabled(wtt.value.id)}">
			    	    <i data-toggle="tooltip" data-placement="bottom" title="Riattiva tipo orario" class="fa fa-power-off"></i>
			    	  </a>
			        </td>

			        <td  class="center">
			          ${wtt.getAssociatedContract().size()}
			          #{if wtt.getAssociatedContract().size() == 0 }
			    	    <a href="@{WorkingTimes.delete(wtt.value.id)}">
			    	      <i data-toggle="tooltip" data-placement="bottom" title="Elimina tipo orario non associato ad alcun contratto" class="fa fa-trash-o"></i>
			    	    </a>
			    	  #{/if}
			    	</td>
			      </tr>	
			    #{/if }  
			    #{/list}
			</table>
			
			
  #{/panel}
	
	

	
	
#{panel title:'Tipi Orario disattivati per ' + office.name, dim:6, offset:3, fluid:true}
		
#{/panel}			


<div class="container">	

	<div class="well">
		<p class="text-danger"><strong><em>Modifica di un tipo orario utilizzato da molti dipendenti</em></strong></p>
		Per motivi di sicurezza e integrità dei dati calcolati in ePAS non viene permessa la modifica diretta dei tipi orario.
		La procedura corretta per modificare il tipo orario è la seguente:
		<ul>
		 <li>Individuare il tipo orario da modificare (es <em>Normale</em>)</li>
		 <li>Creare un nuovo tipo orario con le modifiche opportune rispetto al tipo orario da modificare (es <em>Normale-mod</em>)</li>
		 <li>Attraverso la Form <strong>Cambia orario a tutti</strong> impostare la data (anche passata) a partire dalla quale tutti coloro che hanno impostato
		  il vecchio orario (<em>Normale</em>) vengano migrati al nuovo orario (<em>Normale-mod</em>)</li>
		 <li>Poichè il software provvederà ad effettuare nuovamente tutti i calcoli inerenti tempo lavorato e situazioni residuali 
		per ogni contratto attivo interessato dall'operazione a partire dalla data specificata, questa procedura potrebbe richiedere alcuni minuti.</li>
		</ul>
		
		
		<p><strong class="text-danger"><em>Modifiche per singoli dipendenti</em></strong><br>
		Nel caso di modifiche del tipo orario riguardanti un numero ristretto di dipendenti si consiglia di utilizzare le procedure messe a disposizione
		nella sezione amministrativa Lista Persone.
		</p>
		<p><strong class="text-danger"><em>Eliminare o disabilitare tipi orario</em></strong><br>
		Per eliminare un tipo orario è necessario che non sia associato ad alcun contratto presente in ePAS (anche terminato).<br>
		Per disabilitare un tipo orario è necessario che non sia attualmente associato ad alcun contratto attivo.
		</p>  
	</div>
	
	
	
</div>
	



#{include '_myModal_large.html' /}
#{include '_myModal.html' /}
