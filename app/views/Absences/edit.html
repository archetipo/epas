#{extends 'modal.html' /}
#{set modalHeader:'Modifica assenza in data ' 
+ absence.personDay.date + ' per ' + absence.personDay.person.name + ' ' + absence.personDay.person.surname /}

<div class="container-fluid">

#{form @Absences.update(), enctype:'multipart/form-data'}
	

	<input type="hidden" name="absenceId" value="${absence.id}"/>
	<input type="hidden" name="date" value="${absence.personDay.date}"/>
	<input type="hidden" name="person" value="${absence.personDay.person}"/>
	<input type="hidden" name="personId" value="${absence.personDay.person.id}"/>
	<input type="hidden" name="yearFrom" value="${absence.personDay.date.year}"/>
	<input type="hidden" name="monthFrom" value="${absence.personDay.date.monthOfYear}"/>
	<input type="hidden" name="dayFrom" value="${absence.personDay.date.dayOfMonth}"/>

	<table class="table table-hover table-form">
	  <tr>
	      <td class="lab"><strong>Nuovo<br>Codice</strong></td>
	      <td>
	        <div class="container-fluid" style="padding-left:0px;">
	          <div class="col-sm-6" style="padding-left:0px; padding-bottom:10px;">
	            <input name="absenceCode" type="text" id="absenceCode" value="${absence.absenceType.code}"/><br>
	          </div>
	          <div class="col-sm-6" style="padding-left:0px;">
			    #{select 'code', value: '', class:'col-xs-12', id:'assenzaFrequente', 
			    style:'margin-bottom: 10px;', onclick:'Change();'}
			      <option value="">Codici più usati</option>
			      #{list items: frequentAbsenceTypeList, as:'absenceType'} 
		           #{option absenceType.code}${absenceType.code} ${absenceType.getShortDescription()}#{/option}
			      #{/list}
			    #{/select}
				<br>
				#{select 'code', value: '', class:'col-xs-12', id:'tuttiCodici', onclick:'Change2();'}
			      <option value="">Tutti i codici</option>
			      #{list items: allCodes, as:'absenceType'}
			        #{option absenceType.code}${absenceType.code} ${absenceType.getShortDescription()}#{/option}
	 		      #{/list}
	 		    #{/select}
		      </div>
	        </div>
	        		
	      </td>
      </tr>
    
      <tr>
        <td class="lab"><strong>Fino a</strong></td>
        <td><input name="finoa" value="${absence.personDay.date}" type="text" data-datepicker data-date-format="yyyy-mm-dd"/></td>
	  </tr>
	
	  <tr>
	    <td class="lab"><strong>Allegato</strong></td>
	    <td>
	      <input type="file" name="file">
	    </td>
	  </tr>
	  
	  <tr>
	    <td class="lab"><strong>Buono Mensa</strong></td>
	    <td>
		    #{if absence.absenceType.code.equals("92")}
			    calcolato<input type="radio" name="buonoMensa" value="calcolato" #{if !absence.personDay.isTicketForcedByAdmin } checked="checked" #{/if}/>
		  		No <input type="radio" name="buonoMensa" value="no" 			 #{if absence.personDay.isTicketForcedByAdmin && !absence.personDay.isTicketAvailable } checked="checked" #{/if}/>
		  		Sì <input type="radio" name="buonoMensa" value="si" 			 #{if absence.personDay.isTicketForcedByAdmin && absence.personDay.isTicketAvailable } checked="checked" #{/if}/>
			#{/if}
			#{else}
			   calcolato<input type="radio" name="buonoMensa" value="calcolato" checked="checked" disabled/>	<!-- in questo caso sempre calcolato -->
		  		No <input type="radio" name="buonoMensa" value="no" disabled/>
		  		Sì <input type="radio" name="buonoMensa" value="si" disabled/>
			#{/else}
	    </td>
	  </tr>
	</table>
	<div class="center">
	  <input class="btn btn-primary" type="submit" value="Aggiorna"/>
	</div>
	#{/form}
	<br>
    <div class="well">

		  <p>Lasciando vuoto il campo <em>Nuovo Codice</em> si elimineranno tutte le assenze con codice ${absence.absenceType.code} presenti nella finestra temporale specificata</p>
		  <p>Inserendo nel campo <em>Nuovo Codice</em> un codice diverso da ${absence.absenceType.code} verranno 
		    <ul>
		      <li>eliminate tutte le assenze con codice ${absence.absenceType.code} presenti nella finestra temporale specificata</li>
		      <li>inserite le assenze con codice <em>Nuovo Codice</em> nei giorni appartenenti alla finestra temporale specificata</li>
		      <li><p class="text-error">N.B. in caso di errore in fase di inserimento nuovi codici, la rimozione delle assenze con codice ${absence.absenceType.code} non verrà ripristinata (si potrà comunque procedere al loro reinserimento mediante la form di Inserimento assenze)</p></li>
		    </ul>
		  </p>
		  <p>Nel campo <strong>Fino a</strong> si può specificare fino a quando si vuole modificare/rimuovere un'assenza (di default, contenendo il giorno per cui si è cliccato, verrà modificata/rimossa solo per quel giorno)</p>
		  <p class="text-info">
		    <em>N.B. e' possibile forzare il buono mensa esclusivamente modificando assenze con codice 92 (missione)</em>
		  </p>
	
    </div>
    


</div>


