#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Dati del personale'  /}

#{set 'moreStyles'}
  <style>
    td.personName { text-align: left !important; }
  </style>
#{/set}

<p><a href="@{Persons.insertPerson}"><span class="glyphicon glyphicon-plus"></span> Inserisci una nuova persona</a></p>

<p>
#{form action:@Persons.list(), class:'form', 
    method:'GET', autocomplete:'off',
    'data-reload':'#results'}
    
    <span class="glyphicon glyphicon-search"></span>
    <input type="text" name="name" placeholder="Nome o cognome" value="${name}" class="search-query"/>

#{/form}
</p>

<section id="results">
<table class="table table-striped table-hover table-condensed center" id="listaPersone"><!-- Da aggiungere come entry nel file main.css dove dovrÃ² sistemare le caratteristiche della tabella  -->
	<tr>
		<th>Nome</th>
		<th>Matricola</th>
		<th>Matricola Badge</th>
		<th>Data inizio lavoro</th>
		<th>Data fine lavoro</th>
		<th>Orario</th>
		<th>Ferie</th>
		<th>Livello</th>
		<th>Timbratura<br>Default</th>
		<th>Email</th>
		<th>Contatti</th>
		<th>Inizializzazione</th>
		<th>Invio Email</th>
		<th>Note</th>
	</tr>
	
	#{list items:personList, as:'person'}
	


	<tr>
	#{if person.currentContract != null }
	
		<td class="personName"><a href="@{edit(person.id)}"><font color="#0000FF">${person.surname} ${person.name}</font></a></td>
		<td><font color="#000000">${person.number}</font></td>
		<td><font color="#000000">${person.badgeNumber}</font></td>
		<td><font color="#000000">${person.currentContract != null ? person.currentContract.beginContract : ''}</font></td>
		<td><font color="#000000">${person.currentContract != null ? person.currentContract.expireContract : ''}</font></td>
		
		<td>
		  #{if person.currentWorkingTimeType != null}
		    <a data-toggle="modal" href="@{Persons.showCurrentContractWorkingTimeType(person.id)}" data-target=".my-modal">
		      ${person.currentWorkingTimeType.description}
		    </a>
		  #{/if}
		</td>
		
		<td>
		  #{if person.currentVacationCode != null }
		     <a data-toggle="modal" href="@{Persons.showCurrentVacation(person.id)}" data-target=".my-modal">
		        ${person.currentVacationCode.description}
		     </a>
		  #{/if}
		</td>
		
		<td><font color="#000000">${person.getQualification() != null ? person.getQualification().qualification : ''}</font></td>
		<td>
		  #{if person.currentContract.getCurrentContractStampProfile().fixedworkingtime}
		    <i class="fa fa-check-square-o"></i>
		  #{/if}  
		</td>
		<td><font color="#000000">${person.email != null ? person.email : ''}</font></td>
		<td>
		 <a href="#" data-popover
	    		data-trigger="hover" data-toggle="popover" 
	    		data-placement="bottom"
	    		data-html="true"
	    		data-content="${(
	    		'Dipartimento: <strong>'+person.department+'</strong>'+
	    		'<br>Sede: <strong>'+person.headOffice+'</strong>'+
	    		'<br>Stanza: <strong>'+person.room+'</strong>'+
	    		'<br>Telefono: <strong>'+person.telephone+'</strong>').escape()}"
	    		title="Contatti ${person.name} ${person.surname}"><i class="fa fa-phone"></i></a>
		</td>

		<!-- Inizializzazione ePAS -->
		<td>
		  #{if person.currentContract.sourceDate != null}
		    <i class="fa fa-check-square-o"></i>
		  #{/if}  
		</td>

		<!-- Invio email -->
		<td>
		  #{if person.wantEmail}
		    <i class="fa fa-check-square-o"></i>
		  #{/if}  
		</td>
		
		<!-- Note -->
		
		#{if person.user == null}
			<td><a href="@{Persons.insertUsername(person.id)}">Ins.username</a></td>
		#{/if}
		#{else}
			<td></td>
		#{/else}
	#{/if}
	#{else}
		<td class="personName"><a href="@{edit(person.id)}"><font color="#808080">${person.surname} ${person.name}</font></a></td>
		<td><font color="#808080">${person.number}</font></td>
		<td><font color="#000000">${person.badgeNumber}</font></td>
		<td><!-- begin contract --></td>
		<td><!-- expire contract --></td>
		<td><!-- tipo orario --></td>
		<td><!-- ferie --></td>
		<td><font color="#808080">${person.getQualification() != null ? person.getQualification().qualification : ''}</font></td>
		<td>${''}</td>
		<td><font color="#808080">${person.email != null ? person.email : ''}</font></td>
		<td></td>
		<td>${}</td>
		<td>${}</td>
		<td>${}</td>
	#{/else}
	</tr>

	#{/list}

</table>
</section>

 #{include '_myModal.html' /}

