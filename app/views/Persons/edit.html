#{extends 'main_admin.html' /}

#{functionalMenuForm mainMenu: mainMenu /} 

    <ul class="nav nav-tabs">
    	<li class="active"><a href="@{Persons.edit(person.id)}#">Anagrafica</a></li>
    	<li><a href="@{Persons.personCompetence(person.id, month, year)}#">Competenze</a></li>
    </ul>

<h2 id="titoloModificaDatiPersonali">Modifica dati anagrafici per l'utente
	${person.name} ${person.surname}</h2>
<input type="hidden" name="id" value="${id}"/>
#{form @Persons.update()}
<input type="hidden" name="personId" value="${person.id}"/>
<input type="hidden" name="year" value="${year}"/>
<input type="hidden" name="month" value="${month}"/>

<fieldset>
	<legend>Dati personali</legend>
	<div>
		<b>Cognome</b> <input name="surname" type="text"
			value="${person.surname}" size="20" maxlength="100" />
	</div>
	<div>
		<b>Nome</b> <input name="name" type="text" value="${person.name}"
			size="20" maxlength="50" />
	</div>
	<div>
		Id univoco <input class="span1" name="personId" type="text" value="${person.id}"
			disabled="disabled" />
	</div>
	<!--  <div>Password <input name="person.password" type="text" value="" size="10" maxlength="10" /></div>-->
	<div>
		Matricola <input class="span1" name="number" type="number" value="${person.number}"
			size="10" maxlength="10" />
	</div>
	<div>
		Numbero badge <input class="span1" name="badgeNumber" type="number" value="${person.badgeNumber}"
			size="10" maxlength="20" />
	</div>
	%{if(person.qualification != null){
	}%
	<div>Livello #{select 'person.qualification',
		value:person.qualification.qualification, class:'span1', id:'qualifica'} #{option null}Seleziona la qualifica#{/option}
		#{option 1}1#{/option} #{option 2}2#{/option} #{option 3}3#{/option}
		#{option 4}4#{/option} #{option 5}5#{/option} #{option 6}6#{/option}
		#{option 7}7#{/option} #{option 8}8#{/option} #{/select}</div>
	%{
	}else{
	}%
	<div>Livello #{select 'person.qualification', 
		value:'', class:'span1',id:'qualifica'} #{option null}Seleziona la qualifica#{/option}
		#{option 1}1#{/option} #{option 2}2#{/option} #{option 3}3#{/option}
		#{option 4}4#{/option} #{option 5}5#{/option} #{option 6}6#{/option}
		#{option 7}7#{/option} #{option 8}8#{/option} #{/select} 
	</div>
	%{
	}
	}%
</fieldset>

<fieldset>
	<legend>Dati Contrattuali</legend>
	<p>
		
		<a href="@{Persons.insertContract(person.id)}" class="insertContract${person.id}">Inserisci</a> un nuovo contratto
		<script type="text/javascript"> 
				$('.insertContract${person.id}').popupWindow({ 
				height:600, 
				width:900, 
				scrollbars:1,
				resizable:0,
				top:50, 
				left:50 
				}); 
		</script>
	</p>
	<table>
		<tr>
			<th>Data inizio</th>
			<th>Data fine</th>
			<th>Data terminazione esperienza lavorativa</th>
			<th>Attestato presenza</th>
			<th>Modifica</th>
		</tr>
		%{ for(contract in contractList){ }%
		<tr>
			<td><input name="beginContract" type="date" readOnly="readOnly"
				value="${contract.beginContract}" size="10" maxlength="10" /></td>
			<td><input name="expireContract" type="date" readOnly="readOnly"
				value="${contract.expireContract}" size="10" maxlength="10" /></td> %{
			if(contract.endContract == null){ }%
			<td><a href="@{Persons.terminatePerson(person.id)}">Termina
					contratto</a></td> %{ } else{ }%
			<td><input name="endContract" type="date" readOnly="readOnly"
				value="${contract.endContract}" /></td> %{ } }%
			<td><input name="onCertificate" type="checkbox" readOnly="readOnly"
				value="${contract.onCertificate}" /></td>
			<td>
			<a href="@{Persons.modifyContract(contract.id)}" class="modifyContract${contract.id}"><input value="Modifica" class="Forminput" type="button"></a>
			<script type="text/javascript"> 
				$('.modifyContract${contract.id}').popupWindow({ 
				height:600, 
				width:900, 
				scrollbars:1,
				resizable:0,
				top:50, 
				left:50 
				}); 
				</script>
			</td>
		</tr>
		%{ } }%
	</table>
	%{if(initTime != null){
	}%
		<p id="stanza">Ore di inizializzazione maturate in altro istituto l'anno passato (in minuti): <input class="span1" name="minutesPastYear" type="number" value="${initTime.residualMinutesPastYear}" size="10" /></p>
	%{
	}else{
	}%
		<p id="stanza">Ore di inizializzazione maturate in altro istituto l'anno passato (in minuti): <input class="span1" name="minutesPastYear" type="number" value="" size="10" /></p>
	%{
	}
	}%
	%{if(initTime != null){
	}%
		<p id="stanza">Ore di inizializzazione maturate in altro istituto nell'anno corrente (in minuti): <input class="span1" name="minutesCurrentYear" type="number" value="${initTime.residualMinutesCurrentYear}" size="10" /></p>
	%{
	}else{
	}%
		<p id="stanza">Ore di inizializzazione maturate in altro istituto nell'anno corrente (in minuti): <input name="minutesCurrentYear" type="number" value="" size="10" /></p>
	%{
	}
	}%
	
</fieldset>

<fieldset>
	<legend>Informazioni di ubicazione e contatti</legend>
	<input type="hidden" name="location.person_id" value="${person.id}" />
	<p id="dipartimento">
		Dipartimento <input class="span2" name="department" type="text"
			value="${person.location.department}" size="20" maxlength="100" />
	</p>
	<p id="sede">
		Sede <input class="span2" name="headOffice" type="text"
			value="${person.location.headOffice}" size="20" maxlength="200" />
	</p>
	<p id="stanza">
		Stanza <input class="span2" name="room" type="text" value="${person.location.room}"
			size="20" maxlength="200" />
	</p>
	<p id="telefono">
	%{if(person.contactData.telephone != null || !person.contactData.telephone.equals('No phone number')){
	}%
		Telefono <input class="span2" name="telephone" type="text"
			value="${person.contactData.telephone}" size="20" maxlength="200" />
	%{
	}else{
	}%
		Telefono <input class="span2" name="telephone" type="text"
			value="" size="20" maxlength="200" />
	%{
	}
	}%
	</p>
	<p id="email">
		Email <input class="span2" name="email" type="email"
			value="${person.contactData.email}" size="20" maxlength="200" />
	</p>
	<p id="nascita">
	%{if(person.bornDate != null){
	}%
		Data di nascita <input class="span2" name="bornDate" type="text"
			value="${person.bornDate.convertToLocalDate()}" size="10" maxlength="50" />
	%{
	}else{
	}%
		Data di nascita <input class="span2" name="bornDate" type="text"
			value="" size="10" maxlength="50" />
	%{
	}
	}%
	</p>
</fieldset>


<div id="frm">
<input class="btn btn-primary" id="submitEditPerson"type="submit" value="Ok" />
#{/form} 
#{form @Persons.discard()}
<input class="btn" id="discardEditPerson" type="submit" value="Annulla" />
#{/form} 
#{form @Persons.deletePerson(person.id)}
<input class="btn btn-danger" id="deletePerson" type="submit" value="Elimina" />
#{/form}
</div>