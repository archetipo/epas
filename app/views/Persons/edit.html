#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Modifica ' + person.fullname /}

#{set 'moreStyles'}
<style>
  .panel {
  	margin-top: 20px;
  }
  
  #table-list-contract {
  	margin-top: 30px;
  	margin-bottom: 10px;
  }
</style>
#{/set}

<ul class="nav nav-tabs">
  <li class="active"><a href="@{Persons.edit(person.id)}#">Dati Anagrafici di ${person.fullname}</a></li>
  <li><a href="@{Persons.childrenList(person.id)}#">Gestione figli di ${person.fullname}</a></li>
  #{if person.isPersonInCharge}
  	<li><a href="@{Persons.workGroup(person.id)}">Assegna gruppo di lavoro</a></li>
  #{/if}
</ul>

<div class="container">		<!-- Container dati personali e di contatto -->

	#{form @Persons.update(),,class:'form-horizontal' }
		<input type="hidden" name="person.id" value="${person.id}"/>
		
		<!-- Pannello 1 Dati personali -->
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title"><span class="badge">1</span> Dati Personali</h3>
			</div>
			<div class="panel-body">

				#{f.input 'person.surname'/}
				#{f.input 'person.name'/}
				#{f.input 'person.number',type:'number'/}
				#{f.input 'person.badgeNumber'/}
				#{f.input 'person.email'/}

				#{f.selectModel 'person.qualification',items:templateUtility.allQualifications /}
				#{f.selectModel 'person.office',items:templateUtility.allOfficesAllowed /}

				#{f.checkbox 'person.isPersonInCharge',title:'Selezionare se la persona in questione deve essere un responsabile'/}

				<div class='form-group'>
					<label class="col-sm-3 control-label">Invio mail</label>
					<div class="col-sm-6">
						<a class="btn btn-default" href="@{Persons.modifySendEmail(person.id)}" data-modal=".my-modal">
							#{if person.wantEmail}<i class="fa fa-check-square-o"></i> Attivo#{/if}
							#{else}<i class="fa fa-square-o"></i> Inattivo#{/else}
						</a>
					</div>
				</div>
				<p>
					Abilitando l'invio mail per il dipendente, si permetterà alle procedure di controllo sui 
					<strong><em>giorni con timbrature disaccoppiate</em></strong> e sui
					<strong><em>giorni con mancanza di timbrature e codici assenza</em></strong>, di inviare una mail
					al dipendente contenente i giorni in cui sono stati riscontrati i casi descritti.
				</p>

			</div>
		</div>  <!-- Fine pannello 1 -->
		
		<!-- Pannello 2 Contatti -->
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title"><span class="badge">2</span> Altre informazioni</h3>
			</div>
			<div class="panel-body">

				#{f.input 'person.telephone'/}
				#{f.date 'person.birthday',view:'year'/}
				#{f.input 'person.eppn'/}

				<p>Il campo opzionale <strong>Eppn</strong> viene utilizzato per il login shibboleth quando attivo.</p>

			</div>
		</div>	<!-- Fine pannello 2 -->
		
		</div>
		
		<div class="container-fluid center">
		   <input class="btn btn-primary" type="submit" value="Salva" />
		</div>
	#{/form}

<div class="container">
	<div class="panel panel-default">
	  <div class="panel-heading">
	    <h3 class="panel-title"><span class="badge">3</span> Informazioni su presenza default</h3>
	  </div>
	  <div class="panel-body">
	  	<table class="table table-hover center table-list-contract">
	  		<tr>
	  			<th class="warning">Da</th>
	  			<th class="warning">A</th>
	  			<th class="warning">Presenza automatica</th>
	  			<th class="warning">Modifica presenza automatica</th>
	  			<th class="warning">Elimina periodo</th>
	  		</tr>
	  		#{list items:contractStampProfileList, as:'contractStampProfile'}
	  		<tr>  			
	  			<td><h4><span class="label label-default">${contractStampProfile.startFrom}</span></h4></td>
	  			<td><h4><span class="label label-default">${contractStampProfile.endTo}</span></h4></td>
	  			<td>
	  				#{if contractStampProfile.fixedworkingtime == true}
	  					<i class="fa fa-check-square-o"></i>
	  				#{/if}
	  				#{else}
	  					<i class="fa fa-square-o"></i>
	  				#{/else}
	  			</td>
	  			
	  			<td>
	  				<a href="@{Persons.updateContractStampProfile(contractStampProfile.id)}" data-modal=".my-modal"><i class="fa fa-pencil-square-o"></i> Modifica</a>
	  			</td>
	  			<td>
	  			#{form @Persons.deleteContractStampProfile() }
	  				#{if contractStampProfileList.indexOf(contractStampProfile) > 0}
	  					<input type="hidden" name="contractStampProfile.id" value="${contractStampProfile.id}" />
	  					<a href="@{Persons.deleteContractStampProfile(contractStampProfile.id)}" style="color:red;"><i style="color:red;" class="fa fa-trash-o"></i>Elimina</a>
	  					
	  				#{/if}
	  			#{/form}
	  			</td>
	  		</tr>
	  		#{/list}
	  	</table>
	  </div>
	</div>	<!-- Fine pannello 3 -->
</div>


<div class="container">	<!-- Container dati contrattuali -->

<!-- Pannello 3 Dati contrattuali -->
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><span class="badge">4</span> Dati Contrattuali</h3>
  </div>
  <div class="panel-body">
  	  
	  <table class="table table-hover center table-list-contract">
		<tr class="warning">
			<th>Data inizio contratto</th>
			<th>Data fine contratto</th>
			<th>Data terminazione<br>esperienza</th>
			<th>Orario<br>di lavoro</th>
			<th>Attestato presenza</th>
			<th>Modifica date</th>
			<th>Elimina contratto</th>
			<th>Inizializzazione<br>ePAS</th>
			
		</tr>
		
		#{list items:contractList, as:'contract'}
		
		<tr>
			<td>
			  #{if contract.noRelevant() }
			    irrilevante
			  #{/if}
			   #{if contract.initializationMissing() }
			    mancainit
			  #{/if}
			   #{if contract.monthRecapMissing() }
			    mancariep
			  #{/if}
			  <h4><span class="label label-default">${contract.value.beginContract}</span></h4>
			</td>
			
			<td>
			  <h4><span class="label label-default">${contract.value.expireContract}</span></h4>
			</td>
			
			<td>
			  <h4><span class="label label-default">${contract.value.endContract}</span></h4>
			</td>
			
			<td>
			  
			  #{list items:contract.value.contractWorkingTimeType, as:'wtt'}
			  
			    <a data-popover
	    		data-trigger="hover" data-toggle="popover" 
	    		data-placement="bottom"
	    		data-html="true"
	    		data-content="
	    		${(
	    		'Inizio Periodo: <strong>'+wtt.beginDate+'</strong>'+
	    		'<br>Fine Periodo: <strong>'+wtt.endDate+'</strong>'
	    		).escape()}"
	    		title="Periodo validità orario">
	    		
	    		  <h4><span class="label label-default">${wtt.workingTimeType.description}</span></h4>
	    		
	    		</a>
	    		
			  #{/list}
			  
			  <a href="@{Persons.updateContractWorkingTimeType(contract.value.id)}" data-modal=".my-modal"><i class="fa fa-pencil-square-o"></i> Modifica</a>
			</td>
			
			<td>
			  #{if contract.value.onCertificate == true}
				<i class="fa fa-check-square-o"></i>
			  #{/if}
			  #{else}
				<i class="fa fa-square-o"></i>
			  #{/else}
			</td>
			
			<td>
			  <a href="@{Persons.modifyContract(contract.value.id)}" data-modal=".my-modal"><i class="fa fa-pencil-square-o"></i> Modifica</a>
			</td>
			
			<td>
			  <a href="@{Persons.deleteContract(contract.value.id)}" data-modal=".my-modal"><input value="Elimina" class="btn btn-sm btn-danger" type="button"></a>
			</td>
			
			 <td class="span4" style="text-align: center;">
			 
			 #{if contract.value.sourceDateResidual != null && contract.value.sourceByAdmin == false }
				<span class="glyphicon glyphicon-warning-sign" aria-hidden="true" title="Questa inizializzazione non è ancora stata approvata dall'amministratore"></span>
			 #{/if}
			 
			 #{if contract.value.sourceDateResidual!=null}
			     Situazione alla data
			     <strong class="text-error">${contract.value.sourceDateResidual}</strong><br>
			   #{if contract.value.sourceRemainingMinutesLastYear>0 }
			     Residuo ${contract.value.sourceDateResidual.getYear()-1} 
			     <strong class="text-error">${contract.value.sourceRemainingMinutesLastYear}</strong><br>
			   #{/if}
			   #{if contract.value.sourceRemainingMinutesCurrentYear>0}
			     Residuo ${contract.value.sourceDateResidual.getYear()} 
			     <strong class="text-error">${contract.value.sourceRemainingMinutesCurrentYear}</strong><br>
			   #{/if}
			   #{if contract.value.sourceVacationLastYearUsed>0}
			     Ferie usate ${contract.value.sourceDateResidual.getYear()-1}
			     <strong class="text-error">${contract.value.sourceVacationLastYearUsed}</strong><br>
			   #{/if}
			   #{if contract.value.sourceVacationCurrentYearUsed>0}
			     Ferie usate ${contract.value.sourceDateResidual.getYear()} 
			     <strong class="text-error">${contract.value.sourceVacationCurrentYearUsed}</strong><br>
			   #{/if}
			   #{if contract.value.sourcePermissionUsed>0}
			     Permessi usati ${contract.value.sourceDateResidual.getYear()} 
			     <strong class="text-error">${contract.value.sourcePermissionUsed}</strong><br>
			   #{/if}
			   #{if contract.value.sourceRecoveryDayUsed!=null && contract.value.sourceRecoveryDayUsed>0}
			     Riposi compensativi usati ${contract.value.sourceDateResidual.getYear()} 
			     <strong class="text-error">${contract.value.sourceRecoveryDayUsed}</strong><br>
			   #{/if}
			   #{if contract.value.sourceRemainingMealTicket!=null && contract.value.sourceRemainingMealTicket>0}
			     Buoni pasto residui
			   <strong class="text-error">${contract.value.sourceRemainingMealTicket}</strong><br>
			   #{/if}
			 #{/if}  

			  <a class="btn btn-small" href="@{Persons.updateSourceContract(contract.value.id)}" data-modal=".my-modal-large">Definisci Inizializzazione</a>
			</td>
			
		</tr>
		#{/list}

	  </table>
	  
	  <p>
  	    <a href="@{Persons.insertContract('person.id':person.id)}" data-modal=".my-modal">
  	      <span class="glyphicon glyphicon-plus"></span> Inserisci un nuovo contratto per ${person.surname} ${person.name}
  	    </a>
  	  </p>
	
    </div>
  </div>  <!-- Fine pannello dati contrattuli -->
  
  
   <!-- Pannello 4 Elimina -->
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title"><span class="badge">5</span> Eliminazione persona ePAS</h3>
    </div>
    <div class="panel-body center">
      <a href="@{Persons.deletePerson(person.id)}" data-modal=".my-modal">
  	    <button type="button" class="btn btn-danger">Elimina</button>
  	  </a>
   </div>
  </div>	<!-- Fine pannello 2 -->
  
</div>

#{include '_myModal.html' /}
#{include '_myModal_large.html' /}
