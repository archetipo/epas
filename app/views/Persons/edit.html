#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Modifica ' + person.getFullname() /}

#{set 'moreStyles'}
<style>
  .panel {
  	margin-top: 20px;
  }
  
  #table-list-contract {
  	margin-top: 30px;
  	margin-bottom: 10px;
  
  }
</style>
#{/set}

<ul class="nav nav-tabs">
  <li class="active"><a href="@{Persons.edit(person.id)}#">Dati Anagrafici di ${person.getFullname()}</a></li>
  <li><a href="@{Persons.childrenList(person.id)}#">Gestione figli di ${person.getFullname()}</a></li>
</ul>

<div class="container">		<!-- Container dati personali e di contatto -->

	#{form @Persons.update() }
		<input type="hidden" name="person.id" value="${person.id}"/>
		
		<!-- Pannello 1 Dati personali -->
		<div class="panel panel-default">
		  <div class="panel-heading">
		    <h3 class="panel-title"><span class="badge">1</span> Dati Personali</h3>
		  </div>
		  <div class="panel-body">
		    
		
		    <table class="table table-condensed table-form table-hover">
				<tr>
					<td class="lab"><b>Cognome</b></td>
					<td><input name="person.surname" type="text" value="${person.surname}"/></td>
				</tr>
				<tr>
					<td class="lab"><b>Nome</b></td> 
					<td><input name="person.name" type="text" value="${person.name}"/></td>
				</tr>
				<!-- 
				<tr>
					<td class="lab">Id univoco</td> 
					<td><input name="daeliminare" type="text" value="${person.id}" disabled="disabled" /></td>
				</tr>
				 -->
				<tr>
					<td class="lab">Matricola</td> 
					<td><input name="person.number" type="number" value="${person.number}"/></td>
				</tr>
				<tr>
					<td class="lab">Numbero badge</td>
					<td><input name="person.badgeNumber" type="number" value="${person.badgeNumber}"/></td>
				</tr>
				<tr>
					<td class="lab"> Livello </td>
					<td>
					#{if person.qualification != null}
						#{select 'qualification', value:person.qualification.qualification, class:'span1', id:'withoutborder'} 
						#{option null}Seleziona la qualifica#{/option}
						#{option 1}1#{/option} #{option 2}2#{/option} #{option 3}3#{/option}
						#{option 4}4#{/option} #{option 5}5#{/option} #{option 6}6#{/option}
						#{option 7}7#{/option} #{option 8}8#{/option} #{/select}</div>
					#{/if}
					#{else}
						#{select 'qualification', value:'', class:'span1',id:'withoutborder'} 
						#{option null}Seleziona la qualifica#{/option}
						#{option 1}1#{/option} #{option 2}2#{/option} #{option 3}3#{/option}
						#{option 4}4#{/option} #{option 5}5#{/option} #{option 6}6#{/option}
						#{option 7}7#{/option} #{option 8}8#{/option} #{/select} 
				
					#{/else}
					</td>
				</tr>
				<tr>
					<td class="lab">Sede</td>
					<td>
					    #{select 'office.id', value:person.office.id, id:'office'} 
							#{list items: officeList, as: 'office'}
								#{option office.id}${office.name}#{/option}
							#{/list}
					    #{/select}
					</td>
				</tr>
			
			
			</table>
		
		  </div>
		</div>  <!-- Fine pannello 1 -->
		
		
		
		<!-- Pannello 2 Contatti -->
		<div class="panel panel-default">
		  <div class="panel-heading">
		    <h3 class="panel-title"><span class="badge">2</span> Informazioni di ubicazione e contatti</h3>
		  </div>
		  <div class="panel-body">
			
		    <table class="table table-condensed table-form table-hover">
				<tr>
					<td class="lab">Dipartimento</td>
					<td><input name="person.department" type="text" value="${person.department}"/></td>
				</tr>
				<tr>
					<td class="lab">Sede</td>
					<td><input name="person.headOffice" type="text" value="${person.headOffice}"/></td>
				</tr>
				<tr>
					<td class="lab">Stanza</td>
					<td><input name="person.room" type="text" value="${person.room}"/></td>
				</tr>
				<tr>
					<td class="lab">Telefono</td>
					#{if person.telephone != null || !person.telephone.equals('No phone number') }
						<td><input name="person.telephone" type="text" value="${person.telephone}"/></td>
					#{/if}
					#{else}
						<td><input name="person.telephone" type="text" value=""/></td>
					#{/else}
				</tr>
				<tr>
					<td class="lab">Email</td>
					<td><input name="person.email" type="email" value="${person.email}"/></td>
				</tr>
				<tr>
					<td class="lab">Data di nascita </td>
					#{if person.birthday != null }
						<td><input datepicker name="person.birthday" type="text" value="${person.birthday}"/></td>
					#{/if}
					#{else}
						<td><input datepicker name="person.birthday" type="text" value=""/></td>
					#{/else}
					
				</tr>
				<tr>
					<td class="lab">Email per controllo dati</td>
					#{if person.wantEmail}
						<td><a href="@{Persons.modifySendEmail(person.id)}" data-modal=".my-modal"><i class="fa fa-check-square-o"></i> Modifica</a></td>
					#{/if}
					#{else}
						<td><a href="@{Persons.modifySendEmail(person.id)}" data-modal=".my-modal"><i class="fa fa-square-o"></i> Modifica</a></td>
					#{/else}
				</tr>
			</table>
		  
		  </div>
		</div>	<!-- Fine pannello 2 -->
		
		</div>
		
		<div class="container-fluid center">
		   <input class="btn btn-primary" type="submit" value="Salva" />
		</div>
	#{/form}

<div class="container">
	<div class="panel panel-default">
	  <div class="panel-heading">
	    <h3 class="panel-title"><span class="badge">3</span> Informazioni su presenza default</h3>
	  </div>
	  <div class="panel-body">
	  	<table class="table table-hover center table-list-contract">
	  		<tr>
	  			<th class="warning">Da</th>
	  			<th class="warning">A</th>
	  			<th class="warning">Presenza automatica</th>
	  			<th class="warning">Modifica presenza automatica</th>
	  			<th class="warning">Elimina periodo</th>
	  		</tr>
	  		#{list items:contractStampProfileList, as:'contractStampProfile'}
	  		<tr>  			
	  			<td><h4><span class="label label-default">${contractStampProfile.startFrom}</span></h4></td>
	  			<td><h4><span class="label label-default">${contractStampProfile.endTo}</span></h4></td>
	  			<td>
	  				#{if contractStampProfile.fixedworkingtime == true}
	  					<i class="fa fa-check-square-o"></i>
	  				#{/if}
	  				#{else}
	  					<i class="fa fa-square-o"></i>
	  				#{/else}
	  			</td>
	  			
	  			<td>
	  				<a href="@{Persons.updateContractStampProfile(contractStampProfile.id)}" data-modal=".my-modal"><i class="fa fa-pencil-square-o"></i> Modifica</a>
	  			</td>
	  			<td>
	  			#{form @Persons.deleteContractStampProfile() }
	  				#{if contractStampProfileList.indexOf(contractStampProfile) > 0}
	  					<input type="hidden" name="contractStampProfile.id" value="${contractStampProfile.id}" />
	  					<a href="@{Persons.deleteContractStampProfile(contractStampProfile.id)}" style="color:red;"><i style="color:red;" class="fa fa-trash-o"></i>Elimina</a>
	  					
	  				#{/if}
	  			#{/form}
	  			</td>
	  		</tr>
	  		#{/list}
	  	</table>
	  </div>
	</div>	<!-- Fine pannello 3 -->
</div>


<div class="container">	<!-- Container dati contrattuali -->

<!-- Pannello 3 Dati contrattuali -->
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><span class="badge">4</span> Dati Contrattuali</h3>
  </div>
  <div class="panel-body">
  	  
	  <table class="table table-hover center table-list-contract">
		<tr class="warning">
			<th>Data inizio contratto</th>
			<th>Data fine contratto</th>
			<th>Data terminazione<br>esperienza</th>
			<th>Orario<br>di lavoro</th>
			<th>Attestato presenza</th>
			<th>Modifica date</th>
			<th>Elimina contratto</th>
			<th>Inizializzazione<br>ePAS</th>
			
		</tr>
		
		#{list items:contractList, as:'contract'}
		
		<tr>
			<td>
			  <h4><span class="label label-default">${contract.beginContract}</span></h4>
			</td>
			
			<td>
			  <h4><span class="label label-default">${contract.expireContract}</span></h4>
			</td>
			
			<td>
			  <h4><span class="label label-default">${contract.endContract}</span></h4>
			</td>
			
			<td>
			  
			  #{list items:contract.contractWorkingTimeType, as:'wtt'}
			  
			    <a data-popover
	    		data-trigger="hover" data-toggle="popover" 
	    		data-placement="bottom"
	    		data-html="true"
	    		data-content="
	    		${(
	    		'Inizio Periodo: <strong>'+wtt.beginDate+'</strong>'+
	    		'<br>Fine Periodo: <strong>'+wtt.endDate+'</strong>'
	    		).escape()}"
	    		title="Periodo validitÃ  orario">
	    		
	    		  <h4><span class="label label-default">${wtt.workingTimeType.description}</span></h4>
	    		
	    		</a>
	    		
			  #{/list}
			  
			  <a href="@{Persons.updateContractWorkingTimeType(contract.id)}" data-modal=".my-modal"><i class="fa fa-pencil-square-o"></i> Modifica</a>
			</td>
			
			<td>
			  #{if contract.onCertificate == true}
				<i class="fa fa-check-square-o"></i>
			  #{/if}
			  #{else}
				<i class="fa fa-square-o"></i>
			  #{/else}
			</td>
			
			<td>
			  <a href="@{Persons.modifyContract(contract.id)}" data-modal=".my-modal"><i class="fa fa-pencil-square-o"></i> Modifica</a>
			</td>
			
			<td>
			  <a href="@{Persons.deleteContract(contract.id)}" data-modal=".my-modal"><input value="Elimina" class="btn btn-sm btn-danger" type="button"></a>
			</td>
			
			 <td class="span4" style="text-align: center;">
			 #{if contract.sourceDate!=null}
			     Situazione alla data
			     <strong class="text-error">${contract.sourceDate}</strong><br>
			   #{if contract.sourceRemainingMinutesLastYear>0 }
			     Residuo ${contract.sourceDate.getYear()-1} 
			     <strong class="text-error">${contract.sourceRemainingMinutesLastYear}</strong><br>
			   #{/if}
			   #{if contract.sourceRemainingMinutesCurrentYear>0}
			     Residuo ${contract.sourceDate.getYear()} 
			     <strong class="text-error">${contract.sourceRemainingMinutesCurrentYear}</strong><br>
			   #{/if}
			   #{if contract.sourceVacationLastYearUsed>0}
			     Ferie usate ${contract.sourceDate.getYear()-1}
			     <strong class="text-error">${contract.sourceVacationLastYearUsed}</strong><br>
			   #{/if}
			   #{if contract.sourceVacationCurrentYearUsed>0}
			     Ferie usate ${contract.sourceDate.getYear()} 
			     <strong class="text-error">${contract.sourceVacationCurrentYearUsed}</strong><br>
			   #{/if}
			   #{if contract.sourcePermissionUsed>0}
			     Permessi usati ${contract.sourceDate.getYear()} 
			     <strong class="text-error">${contract.sourcePermissionUsed}</strong><br>
			   #{/if}
			   #{if contract.sourceRecoveryDayUsed!=null && contract.sourceRecoveryDayUsed>0}
			     Riposi compensativi usati ${contract.sourceDate.getYear()} 
			     <strong class="text-error">${contract.sourceRecoveryDayUsed}</strong><br>
			   #{/if}
			   
			   <a class="btn btn-small" href="@{Persons.updateSourceContract(contract.id)}" data-modal=".my-modal">Modifica</a>
			
			 #{/if}
			 #{else}
			   <a class="btn btn-small" href="@{Persons.updateSourceContract(contract.id)}" data-modal=".my-modal">Definisci Inizializzazione</a>
			 #{/else}
			</td>
			
		</tr>
		#{/list}

	  </table>
	  
	  <p>
  	    <a href="@{Persons.insertContract('person.id':person.id)}" data-modal=".my-modal">
  	      <span class="glyphicon glyphicon-plus"></span> Inserisci un nuovo contratto per ${person.surname} ${person.name}
  	    </a>
  	  </p>
	
    </div>
  </div>  <!-- Fine pannello dati contrattuli -->
  
  
  
  
   <!-- Pannello 4 Elimina -->
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title"><span class="badge">5</span> Eliminazione persona ePAS</h3>
    </div>
    <div class="panel-body center">
      <a href="@{Persons.deletePerson(person.id)}" data-modal=".my-modal">
  	    <button type="button" class="btn btn-danger">Elimina</button>
  	  </a>
   </div>
  </div>	<!-- Fine pannello 2 -->
  
  
 
</div>
  
  
 
  
  



#{if session.username.equals('admin')}
<div class="pull-right">
  <a class="btn btn-danger" href="@{Administrators.switchUserTo(person.user.id)}">Assumi questa identitÃ </a>
</div>
#{/if}





#{include '_myModal.html' /}



