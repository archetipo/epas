#{extends 'main.html' /}
#{set header:'navbar' /}
#{set absenceRequestTypeLabel: messages.get('AbsenceRequestType.' + type.toString() + 'S') /}
#{set title:('ePAS - ' + absenceRequestTypeLabel) /}

#{switcher year:true, month:true /}

#{set breadcrumbs:[(absenceRequestTypeLabel):null] /}

%{
	approvalsRequired = 0;
	if (config.officeHeadApprovalRequired) {
	 approvalsRequired++;
	}
	if (config.managerApprovalRequired) {
	 approvalsRequired++;
	}
	if (config.administrativeApprovalRequired) {
	  approvalsRequired++;
	}
	approvalRequired = approvalsRequired > 0
}%

<div class="container">
  #{breadcrumbs breadcrumbs /}

  #{title title:absenceRequestTypeLabel.capitalize(), administration:true /} 
 
  #{b.buttons center:true}
  		<a class="btn btn-success" href="@{AbsenceRequests.blank('person':person, 'type':type)}">
    		<i class="fa fa-plus"></i> &{'AbsenceRequestType.' + type + '.blank'}
  		</a>
  #{/b.buttons}
 
  <table  class="table table-striped table-hover table-bordered table-condensed center" datatable width="100%">
	<thead>
		<tr>
			#{if !onlyOwn}
				<th width="15%" #{if approvalRequired}rowspan="2"#{/if}>&{'absenceRequest.person'}</th>
			#{/if}
		    <th width="10%" #{if approvalRequired}rowspan="2"#{/if}>&{'absenceRequest.type'}</th>
		    <th width="10%" #{if approvalRequired}rowspan="2"#{/if}>dal</th>
			<th width="10%" #{if approvalRequired}rowspan="2"#{/if}>al</th>
			#{if approvalRequired}
				<th colspan="${approvalsRequired}">Approvazione</th>
			#{/if}
			<th #{if approvalRequired}rowspan="2"#{/if}>&{'absenceRequest.note'}</th>
			<th #{if approvalRequired}rowspan="2"#{/if}>Azioni</th>
				
		</tr>			
		#{if approvalRequired}
			<tr>
				#{if config.officeHeadApprovalRequired}
					<th width="10%">Responsabile di sede</th>
				#{/if}
				#{if config.managerApprovalRequired}
					<th width="10%">Responsabile di gruppo</th>
				#{/if}			
				#{if config.administrativeApprovalRequired}
					<th width="10%">&{'absenceRequest.administrativeApproved'}</th>
				#{/if}			
		#{/if}
	</thead>

	<tbody>
		#{list items:results.list(), as:'item'}
			<tr>
				#{if !onlyOwn}
					<td>#{f.value 'item.person.fullname' /}</td>
				#{/if}
				<td>&{'AbsenceRequestType.' + item.type}</td>
				
				<td>#{f.value 'item.startAt', value:config.allDay ? item.startAtAsDate().format() : item.startAt.format() /}</td>	    
				<td>#{f.value 'item.endTo', value:config.allDay ? item.endToAsDate().format() : item.endTo.format() /}</td>
				
				#{if config.officeHeadApprovalRequired}
					<td>#{f.value 'item.officeHeadApproved' /}</td>
				#{/if}
				#{if config.managerApprovalRequired}
					<td>#{f.value 'item.managerApproved' /}</td>
				#{/if}
				#{if config.administrativeApprovalRequired}
					<td>#{f.value 'item.administrativeApproved' /}</td>
				#{/if}
				<td>${item.note}</td>
				<td>
					#{secure.check 'AbsenceRequests.edit', target:item}
						#{b.edit @edit(item.id) /}
					#{/secure.check}
					#{secure.check 'AbsenceRequests.delete', target:item}
						#{b.delete @delete(item.id) /}
					#{/secure.check}
				</td>
			</tr>
		#{/list}
	</tbody>
  </table>
</div>