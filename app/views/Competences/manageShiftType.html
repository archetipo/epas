#{extends 'main.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Gestisci ' + type.description /}

#{set breadcrumbs:['Gestisci servizi':@Competences.activateServices(type.shiftCategories.office.id), 
  (type.description):null] /}
#{breadcrumbs breadcrumbs, noHome:true, container:true /}

<div class="container">

#{title title:'Gestisci attività', administration:true /}

	#{if peopleForShift.isEmpty()}
		#{alert color:'warning'}
			Per poter assegnare dei dipendenti all'attività <strong>${type.description}</strong>
			occorre prima abilitare la competenza turno ai dipendenti stessi andando su: <br>
			<i>Amministrazione</i> <i class="fa fa-long-arrow-right" aria-hidden="true"></i> 
			<i>Competenze</i> <i class="fa fa-long-arrow-right" aria-hidden="true"></i>
			<i>Abilita competenze</i>
		#{/alert}
	#{/if}
	#{else}	
	<div class="text-center">
    <a class="btn btn-success" href="@{Competences.linkPeopleToShift(type.id)}" data-async-modal="#modalAddPersonToActivity"><i class="fa fa-user-plus"></i>
      Inserisci una nuova persona sull'attività</a>
  	</div>
	<table class="table table-striped table-hover table-condensed center" datatable>
	<thead>
    <tr>
      <th>Nome</th>
      <th>Inizio attività di turno</th>
      <th>Fine attività di turno</th>
      <th>Jolly</th>
      <th>Termina</th>
    </tr>
    </thead>
    <tbody>
	#{list items:associatedPeopleShift, as:'psst'}
	<tr>
		<td>${psst.personShift.person.fullName()}</td>
		<td>${psst.beginDate}</td>
		<td>#{if psst.endDate == null}
				<i>Indeterminato</i>
			#{/if}
			#{else}
				${psst.endDate}
			#{/else}
		</td>
		<td>#{if psst.jolly == true}
				SI
			#{/if}
			#{else}
				NO
			#{/else}
		</td>
		<td>
			#{if psst.endDate != null && psst.endDate.isAfter(date)}
			Terminato
			#{/if}
			#{else}
			<a class="btn btn-danger btn-xs" href="@{Competences.deletePersonShiftShiftType(psst.id)}"
           data-async-modal="#defaultModal">Termina partecipazione</a>
			#{/else}</td>
	</tr>
	#{/list}
	</tbody>
	</table>
		
	#{/else}
	
	#{accordionItem 'infoAttivita', parent:'info', title:'Informazioni attività', open:true, color:'primary' }

	#{form action:@Competences.editActivity(), class:'form form-horizontal', 
		'data-async':'#page_content', 'data-async-error':'#absenceCodeData',
		'data-spinner':'#defaultSpinner' }
  		#{if type.persistent}
 			#{f.hidden 'type.id' /}
		#{/if}
		#{alert color: 'info'}
			Il nome e la descrizione della attività possono essere cambiati in qualsiasi momento.
		#{/alert}
		#{f.input 'type.type' /}
		#{f.input 'type.description' /}
		#{f.input 'type.tolerance',type:'number' /}
		#{f.input 'type.hourTolerance', type:'number' /}		
  
	  #{b.buttons center:true}
	  		#{b.submit 'Ok'/}
	  #{/b.buttons}

	#{/form}

	#{/accordionItem}
</div>

<div id="modalAddPersonToActivity" class="modal fade container" tabindex="-1"></div>
<div id="defaultModal" class="modal fade container" tabindex="-1"></div>
