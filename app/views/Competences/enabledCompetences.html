#{extends 'main.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Abilita competenze'  /}

<div class="container">

	#{title title:'Competenze abilitate nel mese di ' + templateUtility.monthName(month) + ' ' + year + ' ' + ' per ' + office.name, color:'primary' /}

	#{include './_tabs.html' /}

  #{alert color:'info'}
  <p>Cliccando sul nome del dipendente è possibile attivare o disattivare la possibilità di attribuire ogni specifica competenza.</p>
  #{/alert}

  <table class="table table-condensed table-hover table-bordered center" datatable >
		<thead>
		<tr>
			<th>Nome</th>
			<th>Competenze Abilitate</th>
		</tr>
		</thead>
		<tbody>

    #{list items:map.entrySet(), as:'key'}
    <tr>
      <td>
			#{secure.link @Competences.updatePersonCompetence(key.getKey().id, year, month), 'data-async-modal':'#updateCompetenceModal' }
        ${key.getKey().fullName()}
			#{/secure.link}
 	  </td>
 	  <td>
 	   #{list items:key.getValue(), as:'dto'}

 	       	#{if dto.endDate != null && dto.endDate.getMonthOfYear() == date.getMonthOfYear() && dto.endDate.getYear() == date.getYear()}
 	       		<span class="label label-warning" webui-popover-hover data-content="&{'endCompetenceCode'}">${dto.code.code} - ${dto.code.description}</span>
 	       	#{/if}
 	       	#{elseif dto.beginDate.getMonthOfYear() == date.getMonthOfYear() && dto.beginDate.getYear() == date.getYear()}
 	       		<span class="label label-success" webui-popover-hover data-content="&{'beginCompetenceCode'}">${dto.code.code} - ${dto.code.description}</span>
 	       	#{/elseif}
 	       	#{else}
 	       		<span class="label label-primary" webui-popover-hover data-content="Attivo da: ${dto.beginDate.format()}">${dto.code.code} - ${dto.code.description}</span>
 	       	#{/else}

       #{/list}
       </td>

    #{/list}
    </tr>
  </tbody>
  </table>

</div>


<div id="updateCompetenceModal" class="modal fade container" tabindex="-1"></div>


