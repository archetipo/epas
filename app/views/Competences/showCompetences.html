#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Gestione competenze'  /}

#{set 'moreStyles'}
  <style>
    #container-fluid-nav-tabs {
    	padding-bottom: 20px;
    }
    
  </style>
#{/set}

<div id="container-fluid-nav-tabs" class="container-fluid">

<ul class="nav nav-tabs">
  <li class="active"><a href="@{Competences.showCompetences(year, month)}">Competenze</a></li>
  <li><a href="@{Competences.overtime(year, month)}">Straordinari</a></li>
  <li><a href="@{Competences.totalOvertimeHours(year, month)}">Monte ore</a></li>
  <li><a href="@{Competences.recapCompetences()}">Recap competenze</a></li>
  <li><a href="@{Competences.exportCompetences()}">Esporta competenze</a></li>
</ul>

</div>

<div class="container-fluid">
  
  <div class="col-md-8">
    <input type="hidden" name="year" value="${year}"/>
    <input type="hidden" name="month" value="${month}"/>

    <div id="container-search" class="col-xs-3">
    #{form action:@Competences.showCompetences()	,  
      method:'GET', autocomplete:'off',
      'data-reload':'#results'}
      <input type="text" name="name" placeholder="Nome o cognome" value="${name}" class="input-medium"/>
    
      <select name="codice" class="input-medium">
        #{list items:activeCompetenceCodes, as:'activeCode'}
          <option value="${activeCode.code}" >${activeCode.code}</option>
        #{/list}
	  </select>
      <i class="icon-search icon-large"></i>
      
      <input type="hidden" name="year" value="${year}"/>
	  <input type="hidden" name="month" value="${month}"/>
    #{/form}
    </div>

    <section id="results">

    
      <ul class="pagination">
  	    #{list items:0..simpleResults.totalPage-1, as:'indexPage', class:'inline'}
  	      #{if simpleResults.page==indexPage}
  	        <li class="active"><a href="#">${indexPage+1}</a></li>
  	      #{/if}
  	      #{else}
  	        <li><a href="@{Competences.showCompetences(year, month, name, codice, indexPage)}">${indexPage+1}</a></li>
  	      #{/else}
	    #{/list}
      </ul>





      <table class="table table-hover">
	    <tr>
	      <th>Nome e cognome</th>
	      <th>${competenceCode.description} ${competenceCode.code}</th>
	    </tr>
	
	    #{list items:activePersons, as:'person'}
	      #{if person.competenceCode.contains(competenceCode) }
	      <tr>
	        <td class="person">${person.name} ${person.surname}</td>
	        <td>
	        #{if person.competenceCode.contains(competenceCode)}
	     	  #{if competenceCode.code.equals('S1')}
	     	    (${person.getPositiveResidualInMonth(year,month)+person.competence(competenceCode,year,month).valueApproved})
	          #{/if}
	        #{/if}
	        <a data-x-editable href="#" data-type="number" data-pk="${person.competence(competenceCode,year,month).id}" data-name="value"
	     	data-url="@{updateCompetence()}" 
	     	data-title="Modifica ${competenceCode.description} per ${person.name} ${person.surname}">${person.competence(competenceCode,year,month).valueApproved}</a>
	        </td>
	      </tr>
	      #{/if}
	    #{/list}
	    
	    <tr>
	      <td><strong>Totale mese istituto</strong></td>
		  <td><strong>${competenceCode.totalFromCompetenceCode(month, year)}</strong></td>
	    </tr>
      </table>

    </section>


    <p><i class="fa fa-info fa-2x"></i> I valori per le reperibilit√† sono espressi in GIORNI, quelli per straordinari e turni in ORE</p>



  </div> <!-- end col-md-8 -->


  <div class="col-md-4">
  <div class="panel-group" id="collapseInfo">
    <div class="panel panel-default	">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#collapseInfo" href="#collapseInfoContent">
            <strong>Competenze  
            <span class="capitalized">&{'views.tags.display.date.month.' + month}</span>
             ${year}</strong>
          </a>
        </h4>
      </div>
      <div id="collapseInfoContent" class="panel-collapse collapse out">
        <div class="panel-body center">
          <table class="table table-condensed table-hover table-form">
            <tr>
              <td class="lab">
                Totale ore di straordinario(S1+S2+S3) pagate a <span class="capitalized">&{'views.tags.display.date.month.' + month}</span>
              </td>
              <td><strong>${totaleOreStraordinarioMensile}</strong></td>
            </tr>
            <tr>
              <td class="lab">Totale ore di straordinario pagate nell'anno</td>
              <td><strong>${totaleOreStraordinarioAnnuale}</strong></td>
            </tr>
            <tr>
              <td class="lab">Totale monte ore nell'anno ${year}</td>
              <td><strong>${totaleMonteOre}</strong></td>
            </tr>
          </table>
        </div>
        
      </div>   
    </div> 
  </div> <!-- end accordion Info -->
  
  </div> <!-- end col-md-4 --> 

</div> <!-- end container-fluid -->
