#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Assegna competenze'  /}


#{competences.competencesTabs activeAction:'showCompetences' /}

<div class="container">
  #{panel title:'Assegna competenze ' + templateUtility.monthName(month) + ' ' + year, color:'primary' }
	
    #{alert color:'info'}
          <p>I valori per le reperibilit√† sono espressi in <strong>giorni</strong>, 
          quelli per straordinari e turni in <strong>ore</strong>.</p>
    #{/alert}
     
    <!-- form paginata --> 
    #{form action:@showCompetences(), class:'form-horizontal', method:'GET',
          'data-reload':'#results', autocomplete:'off'}
	<input type="hidden" name="year" value="${year}"/>
    <input type="hidden" name="month" value="${month}"/>
    <input type="hidden" name="officeId" value="${office.id}"/>
    

        #{f.text 'name', 'data-autochange':true, value:name, autofocus:true,
            placeholder:'search'.label() /}
        #{f.selectModel 'competenceCode', label:'Codice', items:competenceCodeList,
    		value:wrCompetenceCode.value /}
    
    #{/form}
	
	<br>
    
    <section id="results">
   	#{paginate results} 
	   
	   <table class="table table-hover">
	     <tr class="warning">
	       <th>Nome e cognome</th>
	       <th>${wrCompetenceCode.value.description} ${wrCompetenceCode.value.code}</th>
	     </tr>
		
		
	   #{list items:results.results, as:'person'}
	    <tr>
	       %{ wrPerson = person.getWrapper(templateUtility.wrapperFactory); }%
   
           <td class="person">${person.fullname}</td>
           <td>
           
    	      #{if wrCompetenceCode.value.code.equals('S1')}
    	        (${wrPerson.getPositiveResidualInMonth(year,month)})
             #{/if}
           
             <a 
             #{if editCompetence} data-x-editable href="#" data-type="number" 
             data-pk="${wrPerson.competence(wrCompetenceCode.value,year,month).id}" data-name="value"
     	     data-url="@{updateCompetence()}" 
     	     data-title="Modifica ${wrCompetenceCode.value.description} per ${person.fullname}"
     	  	 #{/if}
     	     >
   	 	     ${wrPerson.competence(wrCompetenceCode.value,year,month).valueApproved}
    	    </a>

           </td>
         </tr>
	    #{/list}
	    </table>      
	    #{/paginate}
	    
	    <strong>Totale competenze ${wrCompetenceCode.value.code} assegnate nel mese per ${office.name}</strong>
		<a data-tooltip data-toggle="tooltip" data-placement="right" 
		   title="Per aggiornare questo valore ricaricare la pagina">
		  <strong>${wrCompetenceCode.totalFromCompetenceCode(month, year, office.id)}</strong>
		</a>	      

	  </section>   
      	      
	#{/panel}


  #{panel title:'Riepilogo straordinari ' + office.name, color:'primary' }
      <table class="table table-condensed table-hover">
        <tr>
          <td>
            Totale ore di straordinario pagate a ${templateUtility.monthName(month)} (S1+S2+S3) 
          </td>
          <td class="success"><strong>${totaleOreStraordinarioMensile}</strong></td>
        </tr>
        <tr>
          <td>Totale ore di straordinario pagate nell'anno</td>
          <td class="success"><strong>${totaleOreStraordinarioAnnuale}</strong></td>
        </tr>
        <tr>
          <td>Totale monte ore nell'anno ${year}</td>
          <td class="success"><strong>${totaleMonteOre}</strong></td>
        </tr>
      </table>
#{/panel}
  
</div> <!-- end container-fluid -->
