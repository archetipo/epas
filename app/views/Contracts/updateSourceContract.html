#{modalAsync id:'defaultModal', title:('Dati di inizializzazione di ' + contract.person.fullname) }

#{if contract.sourceDateResidual != null && contract.sourceByAdmin == false}
  <div class="alert alert-danger">
	I valori iniziali sottostanti sono stati creati automaticamente da ePAS, impostando a zero ogni campo. 
	Inserire i valori effettivi e cliccare su <em>Salva</em>, oppure cliccare su <strong>Approva</strong> per 
	validare l'inizializzazione automatica e non visualizzare più questo messaggio. 
	#{form @Persons.approveAutomatedSource()}
	<input type="hidden" name="contractId" value="${contract.id}" />
	<div class="center">
  	  <input class="btn btn-default" type="submit" value="Approva"/>
    </div>
    #{/form}
  </div>  
#{/if}

 <div class="alert alert-danger">
   <p><i class="fa fa-info"></i>  
	  	  Per questo contratto iniziato in data <strong>${contract.beginContract.format()}</strong>	
  		  la possibilità di definire come data di inizializzazione una data precedente a <strong>${dateForInit.format()}</strong> è disabilitata.<br>
  		  Se si desidera definire una nuova inizializzazione scegliere una data uguale o successiva a <strong>${dateForInit.format()}</strong>
  </p>
 </div>
 
#{tabs}
  #{tabItem id:'total', title:'Inizializzazione', active:true /}
  #{tabItem id:'meal', title:'Buoni Pasto' /}
#{/tabs}

#{tabContent}

  #{tabContentItem id:'total', active:true}

     <div class="alert alert-success">
		<p>
          	Tramite questa form è possibile inizializzare la situazione di una persona in un momento arbitrario del contratto selezionato.
  		  </p> 
  		  <p>
  		  Inserire la situazione della persona alla fine della giornata specificata nel campo <strong>Data Inizializzazione</strong>.<br>
  	 	  Una volta definiti i dati il software provvederà a ricalcolare i ripiloghi annuali della persona utilizzando i dati di inizializzazione e i dati presenti nel database 
  		  a partire dal giorno successivo a <strong>Data Inizializzazione</strong>. 
  		  </p>
  		  #{if contract.sourceDateResidual == null }
  		   <p><i class="fa fa-info"></i> 
  		     L'informazione sui buoni pasto residui è indipendente e può essere impostata anche in un secondo momento.
  		   </p>
  		  #{/if}
	  </div>

      #{form @Contracts.saveSourceContract(), class:'form-horizontal'}
	    <input type="hidden" name="contract.id" value="${contract.id}" />
	    
	    #{f.date 'contract.sourceDateResidual', biglabel:true  /}
	    #{f.input 'contract.sourceRemainingMinutesLastYear', biglabel:true /}
	    #{f.input 'contract.sourceRemainingMinutesCurrentYear', biglabel:true  /}
	    #{f.input 'contract.sourceVacationLastYearUsed', biglabel:true  /}
	    #{f.input 'contract.sourceVacationCurrentYearUsed', biglabel:true  /}
	    #{f.input 'contract.sourcePermissionUsed', biglabel:true  /}
	    #{f.input 'contract.sourceRecoveryDayUsed', biglabel:true  /}
	    #{if contract.sourceDateMealTicket == null }
	    	#{f.input 'contract.sourceRemainingMealTicket', biglabel:true  /}
	    #{/if}
	
	    <div class="text-center">
	  	  <input class="btn btn-primary" type="submit" value="Salva"/>
	    </div>
      #{/form}
    
  #{/tabContentItem}
   
  #{tabContentItem id:'meal'}
    
       <div class="alert alert-success">
		  <p>
          	Tramite questa form è possibile inizializzare esclusivamente il <strong>residuo buoni pasto</strong> in un momento arbitrario del contratto selezionato.  
  		  </p> 
       </div>
    
    
       #{form @Contracts.saveSourceContract()}
	    <input type="hidden" name="contract.id" value="${contract.id}" />
	    <input type="hidden" name="onlyMealTicket" value="true" />
	
	    <table class="table table-condensed table-hover table-form">
		<tr>
		  <td class="lab"><strong>Data Inizializzazione buoni pasto (aaaa-mm-gg)</strong> </td>
		  <td><input name="contract.sourceDateMealTicket" type="text" datepicker value="${contract.sourceDateMealTicket.format()}" /></td>
		</tr>
		<tr>
		  <td class="lab">Buoni pasto residui</td>
		  <td><input name="contract.sourceRemainingMealTicket" type="text" value="${contract.sourceRemainingMealTicket}" /></td>
		</tr>
	    </table>
	    <div class="center">
	  	  <input class="btn btn-primary" type="submit" value="Salva"/>
	    </div>
      #{/form}

 #{/tabContentItem}  
#{/tabContent}    

#{/modalAsync}

