#{extends 'main.html' /}
#{set header:'navbar' /}
#{set title:'ePAS - Ferie e permessi' /}


<div class="container">

#{title title:('Ferie e Permessi ' + session.get("yearSelected")) /}
   
   #{if !notInitializedContracts.empty}
     #{alert color:'danger'}
       <p>Risultano non correttamente inizializzati i dati su ferie e permessi per i seguenti 
       contratti attivi nell'anno selezionato.</p>
       <ul>
       #{list items:notInitializedContracts, as:'contract'}
         <li>Contratto iniziato il <strong>${contract.beginDate.format()}</strong></li>
       #{/list}
        </ul>
        <p>Impossibile costruire la situazione richiesta.</p>
     #{/alert}
   #{/if}
   
   #{list items:vacationsRecapList, as:'vacationsRecap'}
	
	#{panel title:'Ferie', dim:6, color:'primary' }
	     
      <table class="table table-bordered table-hover">
      <tr class="warning">
        <th>Anno</th>
        <th>Totali (maturate)</th>
        <th>Utilizzate</th>
        <th>Residue (maturate)</th>
      </tr>

      <!-- Ferie Past year -->  	
      <tr>
        <!-- year -->
        <td>${vacationsRecap.vacationsRequest.year - 1}</td>
        <!-- totali (maturate) -->
        <td>${vacationsRecap.vacationsLastYear.total} (${vacationsRecap.vacationsLastYear.accrued})</td>
        <!-- utilizzate -->
        <td>
           <a href="@{Vacations.vacationsLastYear(vacationsRecap.vacationsRequest.year)}" 
              data-async-modal="#defaultModal">
			${vacationsRecap.vacationsLastYear.used}
		  </a>
	    </td>
	    <!-- residue (maturate) -->
        <td>${vacationsRecap.vacationsLastYear.notYetUsedTotal} 
           (${vacationsRecap.vacationsLastYear.notYetUsedAccrued}) </td>

      </tr>
      
      <!-- Ferie Current year -->
      <tr>
        <!-- year -->
        <td>${vacationsRecap.vacationsRequest.year}</td>
        <!-- totali (maturate) -->
        <td>${vacationsRecap.vacationsCurrentYear.total} (${vacationsRecap.vacationsCurrentYear.accrued})</td>
        <!-- utilizzate -->
        <td>
           <a href="@{Vacations.vacationsCurrentYear(vacationsRecap.vacationsRequest.year)}" 
              data-async-modal="#defaultModal">
			${vacationsRecap.vacationsCurrentYear.used}
		  </a>
	    </td>
	    <!-- residue (maturate) -->
        <td>${vacationsRecap.vacationsCurrentYear.notYetUsedTotal} 
           (${vacationsRecap.vacationsCurrentYear.notYetUsedAccrued}) </td>

      </tr>
  	</table>
  	
	#{/panel}
	
	#{panel title:'Permessi legge 937/77', dim:6, color:'primary' }
	      
      <table class="table table-bordered table-hover">
      <tr class="warning">
        <th>Anno</th>
        <th>Totali (maturati)</th>
        <th>Utilizzati</th>
        <th>Residui (maturati)</th>
      </tr>  	
      <tr>
        <!-- year -->
        <td>${vacationsRecap.vacationsRequest.year}</td>
        <!-- totali (maturate) -->
        <td>${vacationsRecap.permissions.total} (${vacationsRecap.permissions.accrued})</td>
        <!-- utilizzate -->
        <td>
           <a href="@{Vacations.permissionCurrentYear(vacationsRecap.vacationsRequest.year)}" 
              data-async-modal="#defaultModal">
			${vacationsRecap.permissions.used}
		  </a>
	    </td>
	    <!-- residue (maturate) -->
        <td>${vacationsRecap.permissions.notYetUsedTotal} 
           (${vacationsRecap.permissions.notYetUsedAccrued}) </td>
      </tr>
  	</table>
      
	#{/panel}      
    
    <div class="col-md-12">
	
	  <p>I <strong>Piani Ferie</strong> attualmente associati sono i seguenti:<br></p>
	     <table class="table center">
	    <tr class="info">
	      <th>Dal</th>
	      <th>Al</th>
	      <th>Valore</th>
	    </tr>
	    
	    #{list items: vacationsRecap.vacationsRequest.contractVacationPeriod, as: 'vp'}
	    <tr>
	      <td>${vp.beginDate.format()}</td>
	      <td>
	        #{if vp.endDate}${vp.endDate.format()}#{/if}#{else}<em>Indeterminato</em>#{/else}
	      </td>
	      <td>${vp.vacationCode.label()}</td>
	    </tr>
	    #{/list}
	    
	    </table>
	  
		
    </div>
    #{/list}
</div>



