#{extends 'main.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Assenze Attestati'  /}

<div class="container">

#{alert color:'info'}
 <p>Crushcotto ${person.fullname} anno ${yearSituation.year}.</p>
 <p>Data Inizio <strong>${yearSituation.beginDate.format()}</strong></p>
 <p>#{if yearSituation.endDate} Data Fine <strong>${yearSituation.endDate.format()} #{/if}</strong></p>
#{/alert}

<table class="table table-bordered table-condensed table-hover" datatable> 
  <thead>
  <tr>
    <th>Tipo</th>
    <th>Codici</th>
    <th>Ok</th>
    <th>Mancanti<br>Automatiche</th>
    <th>Mancanti<br>Manuali</th>
    <th>Da Rimuovere</th>
    <th>Totali Usabili</th>
    <th>Totali Residue</th>
  </tr>
  </thead>
  <tbody>
  #{list items:yearSituation.absenceSituations, as:'absenceSituation'}
    <tr>
      <td>${absenceSituation.type}</td>
      <td>
        #{list items:absenceSituation.codes(), as:'code'}
          ${code}
        #{/list}
      </td>
      <td>
        #{list items:absenceSituation.datesPerCodeOk.keySet(), as:'code'}
          #{list items:absenceSituation.datesPerCodeOk.get(code), as:'date'}
            <a href="@{Stampings.personStamping(yearSituation.person.id, date.year, date.monthOfYear)}">${date.format()} ${code} </a>
            <i class="fa fa-check text-success" aria-hidden="true"></i><br>
          #{/list}  
        #{/list}
      </td>
      
      <td>
        #{list items:absenceSituation.datesPerCodeToAddAutomatically.keySet(), as:'code'}
          #{list items:absenceSituation.datesPerCodeToAddAutomatically.get(code), as:'date'}
            <a href="@{Stampings.personStamping(yearSituation.person.id, date.year, date.monthOfYear)}">${date.format()} ${code} </a>
            <i class="fa fa-check text-warning" aria-hidden="true"></i><br>
          #{/list}  
        #{/list}
      </td>
      
      <td>
        #{list items:absenceSituation.datesPerCodeToAddManually.keySet(), as:'code'}
          #{list items:absenceSituation.datesPerCodeToAddManually.get(code), as:'date'}
            <a href="@{Stampings.personStamping(yearSituation.person.id, date.year, date.monthOfYear)}">${date.format()} ${code} </a>
            <i class="fa fa-check text-danger" aria-hidden="true"></i><br>
          #{/list}  
        #{/list}
      </td>
      
      <td>
        #{list items:absenceSituation.absencesToRemove, as:'absenceToRemove'}
            <a href="@{Stampings.personStamping(yearSituation.person.id, absenceToRemove.getAbsenceDate().year, absenceToRemove.getAbsenceDate().monthOfYear)}">
            ${absenceToRemove.getAbsenceDate().format()} 
            ${absenceToRemove.absenceType.certificateCode} </a>
            <i class="fa fa-times text-danger" aria-hidden="true"></i><br>
        #{/list}
      </td>
      <td>${absenceSituation.totalUsable}</td>
      <td>${absenceSituation.totalResidual}</td>
    </tr>
  #{/list}
  </tbody>
</table>

<a class="btn btn-warning" href="@{AbsenceGroups.importCertificationsAbsences(yearSituation.person.id, yearSituation.year)}">Importa Assenze</a>


</div>