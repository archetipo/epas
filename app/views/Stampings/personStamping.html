#{extends 'main.html' /}
#{set title:monthRecap.person.surname + ' ' + monthRecap.person.name + ', matricola=' + monthRecap.person.number /}

<h2 id="titoloSituazionePresenzeMensili">Situazione presenze mensile <span class="capitalized">&{'views.tags.display.date.month.' + monthRecap.month}</span> ${monthRecap.year}</h2>


#{logoutForm /}

#{functionalMenuForm monthRecap: monthRecap, personList: personList /}

<table id="presenze_mensili">
	<tr>
		<th>Buono mensa</th>
		<th>Giorno</th>
		<th>Codice di assenza</th>
		<th>1° entrata</th>
		<th>1° uscita</th>
		<th>2° entrata</th>
		<th>2° uscita</th>
		<th>3° entrata</th>
		<th>3° uscita</th>
		<th>4° entrata</th>
		<th>4° uscita</th>
		<th>Tempo lavoro</th>
		<th>Differenza</th>
		<th>Progressivo</th>
		<th>Tipo Orario</th>
	</tr>
	
%{
     for(day in monthRecap.days) {
     		
			
}%
		
<tr>
			%{
			if(day.isHoliday()==false){
			}%	<td>${String.format(messages.get('views.common.yes_or_no.'+ day.mealTicket()))}</td>
			%{
			}else{
			}%	<td>${String.format(messages.get('views.common.yes_or_no.true'))}</td>
			%{
			}
			}%
			%{
			if(day.isHoliday()==false){
			}%	<td class="capitalized">${String.format(messages.get('views.tags.display.date.format.dayAndShortDayName'), day.date.toDate())}</td>
			
			%{
			}else{
			}%	<td class="festivi">${String.format(messages.get('views.tags.display.date.format.dayAndShortDayName'), day.date.toDate())}</td>
			%{
			}
			}%
		
			<td class="assenza"><a href="@{Absences.insertAbsence(day.date)}">${day.absenceList().size()>0  ? day.absenceList().get(0).absenceType.code : '____'}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>

			<td class="ingresso"><a href="@{Stampings.insertStamping}">${day.getStampings().size()>0 ? day.getStampings().get(0).date.toCalendarTime() : '_____'}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>
			
			<td class="uscita"><a href="@{Stampings.insertStamping}">${day.getStampings().size()>1 && day.getStampings().get(1)!=null ? day.getStampings().get(1).date.toCalendarTime() : '_____'}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>
			
			%{
			if(day.getStampings().size()>2 && day.getStampings().get(2)!=null && day.getStampings().get(1)!=null){
			}%	
			<td class="ingresso"><a href="@{Stampings.insertStamping}">${day.checkMinTimeForLunch(day.getStampings())<30 ? 
			day.adjustedStamp(day.getStampings().get(1).date, day.getStampings().get(2).date).toCalendarTime() : day.getStampings().get(2).date.toCalendarTime()}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>
			%{
			}else{
			}% 
			<td class="ingresso"><a href="@{Stampings.insertStamping}">${'_____'}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>
			%{
			}
			}%
			<td class="uscita"><a href="@{Stampings.insertStamping}">${day.getStampings().size()>3 ? day.getStampings().get(3).date.toCalendarTime() : '_____'}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>
			%{
			if(day.getStampings().size()>4 && day.getStampings().get(4)!=null){
			}% <td class="ingresso"><a href="@{Stampings.insertStamping}">${day.getStampings().get(4).date.toCalendarTime()}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>
			%{
			}else{
			}% <td class="ingresso"><a href="@{Stampings.insertStamping}">${'_____'}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>
			%{
			}
			}%
			%{
			if(day.getStampings().size()>5 && day.getStampings().get(5)!=null){
			}% <td class="uscita"><a href="@{Stampings.insertStamping}">${day.getStampings().get(5).date.toCalendarTime()}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>			
			%{
			}else{
			}% <td class="uscita"><a href="@{Stampings.insertStamping}">${'_____'}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>
			%{
			}
			}%
			%{
			if(day.getStampings().size()>6 && day.getStampings().get(6)!=null){
			}% <td class="ingresso"><a href="@{Stampings.insertStamping}">${day.getStampings().get(6).date.toCalendarTime()}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>			
			%{
			}else{
			}% <td class="ingresso"><a href="@{Stampings.insertStamping}">${'_____'}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>
			%{
			}
			}%
			%{
			if(day.getStampings().size()>7 && day.getStampings().get(7)!=null){
			}% <td class="uscita"><a href="@{Stampings.insertStamping}">${day.getStampings().get(7).date.toCalendarTime()}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>			
			%{
			}else{
			}% <td class="uscita"><a href="@{Stampings.insertStamping}">${'_____'}</a><script type="text/javascript"> 
				$('.example3demo').popupWindow({ 
					height:500, 
					width:800, 
					top:50, 
					left:50 
				}); 
				</script></td>
			%{
			}
			}%
			
			%{
			if(day.getStampings().size()==2 ){
	         }% <td class="tempoLavoro">${day.isHoliday()==false ? day.convertTimeAtWork(day.timeAtWork()).toCalendarTime() : ''} <strong>${day.timeAtWork()>360 ? day.checkTimeForLunch(day.getStampings()).code : ''}</strong></td>
			%{
			 }else{
			 }% <td class="tempoLavoro">${day.isHoliday()==false ? day.convertTimeAtWork(day.timeAtWork()).toCalendarTime() : ''} <strong>${day.getStampings().size()==4 && !day.getStampings().contains(null) && day.timeAtWork()>300
			 && day.checkMinTimeForLunch(day.getStampings())<30 ? day.checkTimeForLunch(day.getStampings()).code : ''}</strong></td>
			%{
	         }
	         }%	
	         <td class="differenza">${day.isHoliday()==false ? (day.getDifference()).toHourTime() : ''}</td>
				
	         <td class="progressivo">${day.getProgressive().toHourTime()}</td>	
	         <td>${day.person.workingTimeType != null ? day.person.workingTimeType.description : ''}</td>
		</tr>

%{  		   
     }
     
}%

</table>

<p id="spiegazioneTabellaTimbrature">Il numero di buoni mensa usabili per questo mese e': <strong>${monthRecap.numberOfMealTicketToUse()}</strong>, mentre quelli da restituire sono <strong>${monthRecap.numberOfMealTicketToRender()}</strong>. Il numero di giorni lavorativi in sede è di: <strong>${monthRecap.basedWorkingDays()}</strong> </p>

<p>Riepilogo delle ore di lavoro in eccesso/difetto:</p> 
<p> - Residuo tempo di lavoro dei mesi precedenti: ${personMonth.getResidualFromPastMonth().toHourTime()}</p> 
<p> - Residuo del mese:  ${personMonth.getMonthResidual().toHourTime()}</p>
<p> - Giorni di riposo compensativo: ${personMonth.getCompensatoryRest()} per un totale di: -${(personMonth.getCompensatoryRest()*432).toHourTime()} ore</p>
<p> - Totale residuo a fine mese  <strong>${personMonth.getTotalOfMonth().toHourTime()} ore</strong></p>



*{Significato codici assenza}*
<div>
<h3 align="left">Note:</h3>
<table id="Note timbrature">
	<tr>
		<th width="80">Codice timbratura</th>
		<th width="400">Descrizione</th>
			
	</tr>
%{
     for(smt in monthRecap.getStampingCode()) {
}%
	<tr>
		<td>${smt.code}</td>     
		<td>${smt.description}</td>		
	</tr>
	
	
%{  		   
     }
     
}%

</table>

<br>
<br>
<h3 align="left">Tabella codici di assenza</h3>
<table id="Codici di assenza">
	<tr>
		<th width="80">Codice assenza</th>
		<th width="200">Descrizione</th>
		<th width="80">Numero giorni</th>
			
	</tr>
%{
     for(entry in monthRecap.getAbsenceCode().entrySet()) {
}%
	<tr>
		<td>${entry.getKey().code}</td>     
		<td>${entry.getKey().description}</td>	
		<td>${entry.getValue()}</td>	
	</tr>

%{  		   
     }
     
}%
</table>
</div>