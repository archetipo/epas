#{extends 'main_admin.html' /}
#{set title:person.surname + ' ' + person.name + ', matricola=' + person.number /}

<h2 id="titoloSituazionePresenzeMensili">
	Situazione presenze mensile 
	<span class="capitalized">&{'views.tags.display.date.month.' + month}</span> ${year} 
	di ${person.surname} ${person.name}</h2>




<div class="span14">
<table class="table table-bordered table-condensed" id="presenze_mensili">
	
	<tr>
		<th class="span1">Buono mensa</th>
		<th class="span1">Giorno</th>
		<th>Codice di assenza</th>
		%{ for(int i = 1; i <= numberOfInOut; i++){
		}%
		<th>${i}° entrata</th>
		<th>${i}° uscita</th>
		%{ } }%
		<th class="span1">Inserisci timbratura</th>
		<th>Tempo lavoro</th>
		<th class="span1">Differenza</th>
		<th class="span1">Progressivo</th>
		<th>Tipo Orario</th>
		<th>Note</th>
	</tr>
	
	%{
     for(dayRecap in daysRecap) {
     		
			
	}%
		
	<tr>
			<td>${dayRecap.mealTicket}</td>
			%{
			if(dayRecap.holiday==false)
			{
			}%	
				<td class="capitalized">${String.format(messages.get('views.tags.display.date.format.dayAndShortDayName'), dayRecap.date.toDate())}</td>
			%{
			}
			else
			{
			}%	
				<td class="festivi">${String.format(messages.get('views.tags.display.date.format.dayAndShortDayName'), dayRecap.date.toDate())}</td>
			%{
			}
			}%
		
			<td class="assenza">
			
				<a data-toggle="modal" href="@{Absences.create(dayRecap.person.id, dayRecap.date.year, dayRecap.date.monthOfYear, dayRecap.date.dayOfMonth)}" data-target="#myModal1">___</a>
				%{	
				for (absence in dayRecap.absences) 
				{ 
				%}
				 <a data-toggle="modal" href="@{Absences.edit(absence.id)}" data-target="#myModal1">
					${absence.absenceType.code}
				 </a>
										
				%{
				 }
				 }%
			</td>


			%{  
			for(stampingTemplate in dayRecap.stampingsTemplate){
			}%
			%{
					if(stampingTemplate.colour.equals("in"))
					{
					}%
						<td class="ingresso">
					%{
					}
					else if (stampingTemplate.colour.equals("out"))
					{
					}%
						<td class="uscita">
					%{
					}
					else if (stampingTemplate.colour.equals("warn"))
					{
					}%
						<td class="warn">
					%{
					}
				}%
				%{ if(stampingTemplate.date!=null) { }%
					<a data-toggle="modal" href="@{Stampings.edit(stampingTemplate.stampingId)}" data-target="#myModal2">
					${stampingTemplate.hour}
					</a>	
				 
				 %{
				 }
				 }%
				 
				<strong>${stampingTemplate.identifier}</strong>
				<strong>${stampingTemplate.markedByAdminCode}</strong>
				<strong>${stampingTemplate.missingExitStampBeforeMidnightCode}</strong>

				</td>
			
			%{ 
			} 
			}%
	
			<td class="inserisciTimbratura"><a data-toggle="modal" href="@{Stampings.create(dayRecap.person.id, dayRecap.date.year, dayRecap.date.monthOfYear, dayRecap.date.dayOfMonth)}" data-target="#myModal2">+++</a>
				
			</td>
			<td class="tempoLavoro">
				${dayRecap.workTime}
				<strong>${dayRecap.todayLunchTimeCode}</strong>
				<strong>${dayRecap.fixedWorkingTimeCode}</strong>
				<strong>${dayRecap.exitingNowCode}</strong>
			</td>							
	       	<td class="differenza">
	       		${dayRecap.difference}
	       	</td>	
			<td class="progressivo">
			 	${dayRecap.progressive}
		    </td>
	        
	        <td>${dayRecap.workingTimeTypeDescription}</td>
	        
	        <td>
	    	%{
    		for(n in dayRecap.note) 
    		{
			}%
	       		${n}<br>
	        %{
	        }
	        }%
	        </td>
	</tr>

	%{  		   
 	}
   
	}%

</table>

</div>


#{include './_riepilogoRiassuntivoMese.html' /}

<div id="myModal1" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>Inserimento/modifica assenza</h3>
  </div>
  <div class="modal-body">
    <p></p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
   <!--   <button class="btn btn-primary">Save changes</button>-->
  </div>
</div>

<div id="myModal2" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>Inserimento/modifica timbratura</h3>
  </div>
  <div class="modal-body">
    <p></p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
   <!--   <button class="btn btn-primary">Save changes</button>-->
  </div>
</div>
