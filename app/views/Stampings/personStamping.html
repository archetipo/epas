#{extends 'main_admin_no_menu.html' /}
#{set title:person.surname + ' ' + person.name + ', matricola=' + person.number /}
#{set titolo: 'Situazione presenze mensile ' +  month_capitalized + ' ' + year + ' di ' + person.surname + ' ' + person.name /}

<div class="row-fluid first-row">
  <div class="span8" style="min-width: 900px;">
    <table id="tabellonetimbrature" class="table table-bordered table-condensed">
      
      
      <tr>
		<th class="group-single">Giorno</th>
		<th class="group-single">Buono<br>mensa</th>
		
		<th class="invisible"></th>
		
		<th class="group-single">Codice <br>assenza</th>
		
		
		
		#{list items:1..numberOfInOut, as:'i'}
			<th class="group-left">${i}<sup>a</sup> <br/>entrata</th>
			<th class="group-right">${i}<sup>a</sup> <br/>uscita</th>
		#{/list}
		<th class="group-single">Inserisci<br>timbratura</th>
		
		<th class="invisible"></th>
		
		<th class="group-single">Tempo<br>lavoro</th>
		<th class="group-single">Diffe-</div><br/>renza</th>
		<th class="group-single">Progres-<br/>sivo</th>		
		<th class="group-single">Tipo<br>Orario</th>
		<th class="group-single">Note</th>
	  </tr>
      
      
	  
	  #{list items:daysRecap, as:'dayRecap'}
	  <tr>
	    #{if dayRecap.holiday==false}
		  <td class="capitalized default-single">${String.format(messages.get('views.tags.display.date.format.dayAndShortDayName'), dayRecap.date.toDate())}</td>
		#{/if}
		#{else}
		  <td class="festivi default-single">${String.format(messages.get('views.tags.display.date.format.dayAndShortDayName'), dayRecap.date.toDate())}</td>
		#{/else}

        <td class="default-single">
		#{if dayRecap.mealTicket.equals("NO")}
		  <i class="icon-ban-circle"></i>
		#{/if} 
		#{if dayRecap.mealTicket.equals("NOT_YET")}
		  <i class="icon-remove"></i>
		#{/if} 
		#{if dayRecap.mealTicket.equals("YES")}
		  <i class="icon-ok"></i>
		#{/if} 
		</td>

		<td class="invisible"></td>
		
		<td class="assenza default-single">
		  <a data-toggle="modal" data-backdrop="true" href="@{Absences.create(dayRecap.person.id, dayRecap.date.year, dayRecap.date.monthOfYear, dayRecap.date.dayOfMonth)}" data-target="#myModal1">___</a>
		  #{list items:dayRecap.absences, as:'absence'}
		    <a data-toggle="modal" href="@{Absences.edit(absence.id)}" data-target="#myModal3">
			  ${absence.absenceType.code}
			</a>
		  #{/list}	
		</td>
		
		#{list items:dayRecap.stampingsTemplate, as:'stampingTemplate'}
		  #{if stampingTemplate.colour.equals("in")}
			<td class="position${stampingTemplate.pairPosition} pair${stampingTemplate.pairId} default-left">
		  #{/if}
		  #{elseif stampingTemplate.colour.equals("out")}
		    <td class="position${stampingTemplate.pairPosition} pair${stampingTemplate.pairId} default-right">
		  #{/elseif}
		  #{elseif stampingTemplate.colour.equals("warn")}
		    <td class="position${stampingTemplate.pairPosition} pair${stampingTemplate.pairId} warn">
	      #{/elseif}
					
		  #{if stampingTemplate.date!=null}
		    <a data-toggle="modal" href="@{Stampings.edit(stampingTemplate.stampingId)}" data-target="#myModal2">
			  ${stampingTemplate.hour}
			</a>
		  #{/if}
		  #{elseif stampingTemplate.pairPosition.equals("center")}
		    <abbr title="Timbratura di servizio mancante" class="initialism"><i class="icon-warning-sign"></i></abbr>
		  #{/elseif}

		  #{ifnot stampingTemplate.identifier.equals("")}
			<strong>${stampingTemplate.identifier}</strong>
		  #{/ifnot}	
		  #{ifnot stampingTemplate.markedByAdminCode.equals("")}
			<strong>${stampingTemplate.markedByAdminCode}</strong>
		  #{/ifnot}	
		  #{ifnot stampingTemplate.missingExitStampBeforeMidnightCode.equals("")}
			<strong>${stampingTemplate.missingExitStampBeforeMidnightCode}</strong>
		  #{/ifnot}	
		  <!--  ${stampingTemplate.pairId}${stampingTemplate.pairPosition}  -->		
		  </td>
	    #{/list}
	    <td class="inserisciTimbratura default-single">
		    <a data-toggle="modal" data-backdrop="true" href="@{Stampings.create(dayRecap.person.id, dayRecap.date.year, dayRecap.date.monthOfYear, dayRecap.date.dayOfMonth)}" data-target="#myModal2">
		      +++
		    </a>
		</td>
		
		<td class="invisible"></td>
		
	    <td class="tempoLavoro default-single">
		  ${dayRecap.workTime}
		  #{ifnot dayRecap.todayLunchTimeCode.equals("")}
		    <strong>${dayRecap.todayLunchTimeCode}</strong>
		  #{/ifnot}
		  #{ifnot dayRecap.fixedWorkingTimeCode.equals("")}
		  	<strong>${dayRecap.fixedWorkingTimeCode}</strong>
		  #{/ifnot}	
		  #{ifnot dayRecap.exitingNowCode.equals("")}
		    <strong>${dayRecap.exitingNowCode}</strong>
		  #{/ifnot}
		</td>	
			
		#{if dayRecap.differenceNegative}
		  <td class="differenza  default-single" style="color: red;">${dayRecap.difference}</td>
		#{/if}
		#{else}
		  <td class="differenza default-single">&nbsp;${dayRecap.difference}</td>
		#{/else}
			
		#{if dayRecap.progressiveNegative}
		  <td class="progressivo default-single" style="color: red;">${dayRecap.progressive}</td>
		#{/if}
		#{else}
		  <td class="progressivo default-single">&nbsp;${dayRecap.progressive}</td>
		#{/else}
												
	    <td class="default-single">
	      #{if dayRecap.wtt!=null && dayRecap.wttd!=null}
	        <a href="#" data-popover
	    		data-trigger="hover" data-toggle="popover" 
	    		data-placement="bottom"
	    		data-html="true"
	    		data-content="${(
	    		'Tempo Lavoro: <strong>'+dayRecap.workingTime+'</strong>'+
	    		'<br>Tempo lavoro per buono pasto: <strong>'+dayRecap.mealTicketTime+'</strong>'+
	    		'<br>Durata minima intervallo pranzo: <strong>'+dayRecap.breakTicketTime+'</strong>'+
	    		'<br>Finestra intervallo pranzo: <strong>'+dayRecap.timeMealFrom+' - ' +dayRecap.timeMealTo+'</strong>'+
	    		' (estremi compresi)').escape()}"
	    		title="Info orario giornaliero">${dayRecap.workingTimeTypeDescription}</a>
	      #{/if}
	      
	      
	    </td>
	    <td class="default-single">
	    #{if dayRecap.note.size != 0}
	    
	    	<a href="#" class="btn btn-small" data-popover
	    		data-trigger="hover" data-toggle="popover" 
	    		data-placement="right"
	    		data-html="true"
	    		data-content="${('<ul><li>'+dayRecap.note.join('</li><li>')+'</li></ul>').escape()}"
	    		title="Info timbrature">Info</a>    
	    
	    #{/if}
	    </td>
		
	  </tr>
	  #{/list}
    </table>
  </div>
  <div class="span4">
     #{include './_riepilogoRiassuntivoMese.html' /}
  </div>
</div>


<div id="myModal1" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>Inserimento assenza ${person.surname} ${person.name}</h3>
  </div>
  <div class="modal-body">
    <p></p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
   <!--   <button class="btn btn-primary">Save changes</button>-->
  </div>
</div>

<div id="myModal3" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabe3" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>Modifica assenza ${person.surname} ${person.name}</h3>
  </div>
  <div class="modal-body">
    <p></p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
   <!--   <button class="btn btn-primary">Save changes</button>-->
  </div>
</div>
 


<div id="myModal2" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>Inserimento/modifica timbratura</h3>
  </div>
  <div class="modal-body">
    <p></p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
   <!--   <button class="btn btn-primary">Save changes</button>-->
  </div>
</div>
