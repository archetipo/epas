<td class="assenza default-single">
  #{secure.check 'AbsenceGroups.insert', target: yearMonth }
    #{secure.check 'AbsenceGroups.insert',  target:person}
    <a href="@{AbsenceGroups.insert(dayRecap.personDay.person.id, dayRecap.personDay.date?.format())}" data-async-modal="#modalGroupAbsence">
      __
    </a>
    #{/secure.check}
  #{/secure.check}

  #{list items:dayRecap.personDay.absences, as:'absence'}
    
    %{ involvedGroups = templateUtility.involvedGroupAbsenceType(absence.absenceType); }%
    #{if absence.isReplacing(involvedGroups) && !absence.isOrphanReplacing(involvedGroups) }
        *{ l'assenza di rimpiazzamento non orfana non la visualizzo }*
    #{/if}
    #{else}
    
	      #{absences.absence-popover absence:absence, person:person, noLabel:true /}
	      
	      #{secure.link @AbsenceGroups.edit(absence.id), target: absence, 'data-async-modal':'#modalAbsence'}
	      
	      <span webui-popover-hover data-url="#${absence.id}"
	      
	        *{ colore codice assenza }*
	        #{if !absence.troubles.empty}              class="text-danger"   #{/if}
	        #{elseif absence.absenceType.internalUse}  class="text-muted"    #{/elseif}
	        #{else}                                    class="text-primary"  #{/else}>
	        
	        
		    #{if !absence.troubles.empty} 
		      <strong>${absence.absenceType.code}</strong>
		    #{/if}
		    #{else} 
		      ${absence.absenceType.code} 
		    #{/else}
		    
		    #{secure.check 'AbsenceGroups.edit'}
		    #{if absence.hasReplacing() }
		      *
		    #{/if}
		    #{/secure.check}
		  </span>
		  
		  #{/secure.link}
    
    #{/else}

    #{if absence.absenceFile.exists()}
      #{secure.link @Absences.downloadAttachment(absence.id), fa:'paperclip'}#{/secure.link}
    #{/if}
  #{/list}
</td>