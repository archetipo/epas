#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Gestione sedi'  /}


<div class="container">
	<!-- TODO 
	<p>
	  <a  data-modal=".my-modal" href="@{Offices.insertArea()}">
	    <span class="glyphicon glyphicon-plus"></span> Crea una nuova Area
	  </a>
	</p>
	 -->

	#{list items:allAreas, as:'area'}
	  #{if area.isPrintable() }
		<div class="panel panel-info">
		  <div class="panel-heading">
		    <h3 class="panel-title">${area.name}</h3>
		  </div>
		  <div class="panel-body">
		  
		    <p>Il numero totale dei dipendenti presenti in ePAS con contratto attivo in quest area Ã¨ <strong>${area.getActivePersons().size()}</strong></p>
		    
		    #{if session.username.equals("admin") }
		    <p>
		      <a  data-modal=".my-modal" href="@{Offices.insertInstitute(area.id)}">
		        <span class="glyphicon glyphicon-plus"></span> Crea un nuovo istituto per ${area.name}
		      </a>
		    </p>
		  	#{/if}
		  	
		  	#{list items:area.getInstitutes(), as:'istituto'}
		  	  #{if istituto.isPrintable() }
			  	  <div class="well">
			  	    <p class="lead">${istituto.name}</p>
				    
				    <table class="table table-hover">
				      <tr class="warning center">
				        <th>Sede</th>
				        <th>Indirizzo</th>
				        <th>Codice</th>
				        <th>Data<br>Affiliazione</th>
				        <th>Numero<br>Dipendenti</th>
				        <th>Amministratori</th>
				        <th>Amministratori<br>sola lettura</th>
				      </tr>
				      
				      #{list items:istituto.getSeats(), as:'sede'}
				      #{if sede.isPrintable() }
				        <tr style="background-color: white;">
				          <td>
				          #{if sede.isEditable() }
				            <a data-modal=".my-modal" href="@{Offices.editSeat(sede.id)}">${sede.name}</a>
				          #{/if}
				          #{else}
				            ${sede.name}
				          #{/else}
				          </td>
				          <td>${sede.address}</td>
				          <td class="center">${sede.code}</td>
				          <td class="center">${sede.joiningDate}</td>
				          <td class="center">${sede.getActivePersons().size()}</td>
				          <td class="center">
				            #{list items:sede.getPersonnelAdmin(), as:'person'}
				              ${person.surname} ${person.name}<br>
				            #{/list}
				          </td>
				          <td class="center">
				            #{list items:sede.getPersonnelAdminMini(), as:'person'}
				              ${person.surname} ${person.name}<br>
				            #{/list}
					          </td>
				        </tr>
				      #{/if}  
				  	  #{/list} 
				    </table>
				    #{if session.username.equals("admin") }
				    <p>
			          <a  data-modal=".my-modal" href="@{Offices.insertSeat(istituto.id)}">
			            <span class="glyphicon glyphicon-plus"></span> Crea una nuova sede per ${istituto.name}
			          </a>
			        </p>
			        #{/if}
				  </div>
			  #{/if}  
			#{/list}

		  </div>
		</div>   
	  #{/if}
	#{/list}
	
</div>

#{include '_myModal.html' /}


