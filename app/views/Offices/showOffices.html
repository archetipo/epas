#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Gestione sedi'  /}

<div class="container">
	<!-- TODO 
	<p>
	  <a  data-modal=".my-modal" href="@{Offices.insertArea()}">
	    <span class="glyphicon glyphicon-plus"></span> Crea una nuova Area
	  </a>
	</p>
-->

#{list items:allAreas, as:'area'}
<div class="panel panel-info">
	<div class="panel-heading">
		<h3 class="panel-title">${area.value.name}</h3>
	</div>
	<div class="panel-body">
		
		<p>Il numero totale dei dipendenti presenti in ePAS con contratto attivo in quest area Ã¨ <strong>${area.activePersonsInOffice().size()}</strong></p>

		<p>
			<a data-modal=".my-modal" href="@{Offices.insertInstitute(area.value.id)}">
				<span class="glyphicon glyphicon-plus"></span> Crea un nuovo istituto per ${area.value.name}
			</a>
		</p>

		#{list items:area.getWrapperInstitutes(), as:'istituto'}
		
		<div class="well">
			<a data-modal=".my-modal" href="@{Offices.editInstitute(istituto.value.id)}"><p class="lead">${istituto.value.name}</p></a>

			<table class="table table-hover">
				<tr class="warning center">
					<th>Sede</th>
					<th>Informazioni</th>
					<th>Amministratori</th>
					<th>Amministratori<br>sola lettura</th>
					<th>Account <br>di Sistema</th>
				</tr>
				
				#{list items:istituto.getWrapperSeats(), as:'sede'}
				<tr style="background-color: white;">
					<!-- Seat data -->
					<td>
						<!-- codice per allineare sul fondo della cella l'elemento nel div interno -->
						<div style="position:relative; overflow: auto; height: 100%;">
							<!-- questo contenuto sta in cima alla cella -->
							<a data-modal=".my-modal" href="@{Offices.editSeat(sede.value.id)}">${sede.value.name}</a>
							<div style="position:absolute; bottom:0;">
								<!-- questo contenuto sta in fondo alla cella -->
								<a class="btn btn-success btn-xs" href="@{Import.syncSeatPeople(sede.value.id)}">
									<i class="fa fa-user-plus"></i> Sincronizza Persone di questa Sede</a>
								</div>
							</div>
						</td>
						<td>
							<strong>Indirizzo:</strong> ${sede.value.address}<br>
							<strong>Codice:</strong> ${sede.value.codeId}<br>
							#{if sede.value.joiningDate != null}
							<strong>Data affiliazione a ${istituto.value.contraction}:</strong> ${sede.value.joiningDate}<br>
							#{/if}
							<strong>Numero Dipendenti:</strong> ${sede.activePersonsInOffice().size()}<br>
							
							<br>
							<strong>Lettori sede abilitati</strong><br>
							#{list items:sede.getActiveBadgeReaders(), as:'badgeReader'}
							<h4><span class="label label-success">${badgeReader}</span></h4>
							#{/list}
						</td>
						<!-- End Seat Data -->
						
						<!-- Seat administrator -->
						<td class="center">
							<a class="btn btn-primary btn-xs"
							data-modal=".my-modal"
							href="@{Administrators.insertNewAdministrator(sede.value.id, roleAdmin.id)}">
							<span class="glyphicon glyphicon-plus" 
							data-toggle="tooltip" data-placement="left" 
							title="Aggiungi Amministratore per ${sede.value.name}">
						</span>
					</a>  
					<br>
					#{list items:sede.getPersonnelAdmin(), as:'person'}
					<br>${person.surname} ${person.name}
					#{if person.user.username.equals(session.username) }
					<a href="@{Administrators.deleteSelfAsAdministrator(sede.value.id)}" data-modal=".my-modal">
						#{/if}
						#{else}
						<a href="@{Administrators.deleteAdministrator(sede.value.id, person.id)}">
							#{/else}
							<span class="glyphicon glyphicon-trash" 
							data-toggle="tooltip" data-placement="left" 
							title="Rimuovi dagli amministratori ${person.surname} ${person.name}">
						</span>
					</a>
					#{/list}
				</td>
				<td class="center">
					<a class="btn btn-primary btn-xs"
					data-modal=".my-modal"
					href="@{Administrators.insertNewAdministrator(sede.value.id, roleAdminMini.id)}">
					<span class="glyphicon glyphicon-plus" 
					data-toggle="tooltip" data-placement="left" 
					title="Aggiungi Amministratore sola lettura per ${sede.value.name}">
				</span>
			</a>
			<br>
			#{list items:sede.getPersonnelAdminMini(), as:'person'}
			<br>${person.surname} ${person.name}
			<a href="@{Administrators.deleteAdministrator(sede.value.id, person.id)}">
				<span class="glyphicon glyphicon-trash" 
				data-toggle="tooltip" data-placement="left" 
				title="Rimuovi dagli amministratori ${person.surname} ${person.name}">
			</span>
		</a>
		#{/list}
	</td>
	
	<td class="center">
		<a class="btn btn-primary btn-xs"
		data-modal=".my-modal"
		href="@{Administrators.insertAccountSystem(sede.value.id)}">
		<span class="glyphicon glyphicon-plus" 
		data-toggle="tooltip" data-placement="left" 
		title="Aggiungi Amministratore per ${sede.value.name}">
	</span>
</a>  
<br>
<br>
#{list items:sede.getSeatSystemUsersRolesOffices(), as:'systemUro'}

<strong>${systemUro.role.name}</strong> ${systemUro.user.username} 

<a href="@{Administrators.deleteAccountSystem(systemUro.id)}">
	<span class="glyphicon glyphicon-trash" 
	data-toggle="tooltip" data-placement="left" 
	title="Rimuovi dagli account di sistema.">
</span>
</a>

<br>
#{/list}
</td>

<!-- End Seat administrator -->
</tr>
#{/list} 
</table>
<p>
	<a  data-modal=".my-modal" href="@{Offices.insertSeat(istituto.value.id)}">
		<span class="glyphicon glyphicon-plus"></span> Crea una nuova sede per ${istituto.value.name}
	</a>
</p>
</div> 
#{/list}

</div>
</div>   
#{/list}

</div>

<a class="btn btn-primary pull-right" href="@{Import.officeList()}">Importa da Perseo</a>	

#{include '_myModal.html' /}


