#{extends 'main3.html' /} 
#{set header:'navbar' /} 
#{set title: 'ePAS - Ferie e Permessi' /} 

#{set 'moreStyles'}

<style>
/* allineamento centrato dei th con rowspan e colspan */
#tabella-ferie th {
	vertical-align: inherit;
}
</style>

#{/set}

<div class="container">
  #{title title:'Ferie e Permessi ' + year, administration:true /}
</div>  

<div class="container">

  <table  class="table table-striped table-hover table-bordered table-condensed" datatable width="100%">
	<thead>
		<tr>
			<th class="col-md-3">Nome</th>
			<th>Ferie Fatte ${year-1}</th>
			<th>Ferie Fatte ${year}</th>
			<th>Permessi Fatti ${year}</th>
			
			<th>Ferie ${year-1}<br> 
			   #{if isVacationLastYearExpired}<span class="glyphicon glyphicon-remove" style="color: red;"></span>#{/if}
			   #{else}<span class="glyphicon glyphicon-ok" style="color: green;"></span>#{/else}
			</th>
			
			<th>Ferie ${year}<br>Residue Totali
			</th>
			<th>Ferie ${year}<br>Residue Maturate
			</th>
			<th>Permessi<br>Residui Totali
			</th>
			<th>Permessi<br>Residui Maturati
			</th>
			<th>Limite <br>Iniziale
			</th>
			<th>Limite <br>Finale
			</th>
		</tr>
	</thead>

	<tbody>
		#{list items:vacationsList, as:'vacationsRecap'}
		<tr>
			<!-- ferie e permessi fatti -->
			<td>${vacationsRecap.vacationsRequest.contract.person.fullname}</td>

			<td data-order="${vacationsRecap.vacationsLastYear.used}">
				<a
				href="@{VacationsAdmin.vacationsLastYear(vacationsRecap.vacationsRequest.contract, 
				    vacationsRecap.vacationsRequest.year)}"
				data-async-modal="#defaultModal">
					${vacationsRecap.vacationsLastYear.used} </a>
			</td>

			<td data-order="${vacationsRecap.vacationsCurrentYear.used}">
				<a
				href="@{VacationsAdmin.vacationsCurrentYear(vacationsRecap.vacationsRequest.contract, 
				    vacationsRecap.vacationsRequest.year)}"
				data-async-modal="#defaultModal">
					${vacationsRecap.vacationsCurrentYear.used} </a>
			</td>

			<td data-order="${vacationsRecap.permissions.used}"><a
				href="@{VacationsAdmin.permissionCurrentYear(vacationsRecap.vacationsRequest.contract, 
				    vacationsRecap.vacationsRequest.year)}"
				data-async-modal="#defaultModal"> ${vacationsRecap.permissions.used} </a></td>

			<!-- residui -->

			<!-- ferie anno passato -->
			<td>${vacationsRecap.vacationsLastYear.notYetUsedTotal}</td>

			<!-- ferie 2014 -->
			<td>${vacationsRecap.vacationsCurrentYear.notYetUsedTotal}</td>
			<td>${vacationsRecap.vacationsCurrentYear.notYetUsedAccrued}</td>

			<!-- permessi 2014 -->
			<td>${vacationsRecap.permissions.notYetUsedTotal}</td>
			<td>${vacationsRecap.permissions.notYetUsedAccrued}</td>

			<td>
			  #{if vacationsRecap.isActiveAfterBeginYear } 
			    <span class="badge badge-success">${vacationsRecap.vacationsRequest.contractDateInterval.getBegin()}</span>
			  #{/if}
			</td>

			<td>
			  #{if vacationsRecap.isExpireBeforeEndYear } 
			    <span class="badge badge-important">${vacationsRecap.vacationsRequest.contractDateInterval.getEnd()}</span>
			  #{/if}
			</td>

		</tr>
		#{/list}

	</tbody>
  </table>





			<p>
				<br> #{if isVacationLastYearExpired} <span
					class="glyphicon glyphicon-remove" style="color: red;"></span>
				Ferie anno precedente scadute. #{/if} #{else} <span
					class="glyphicon glyphicon-ok" style="color: green;"></span> Ferie
				anno precedente utilizzabili. #{/else}
			</p>

			#{if contractsWithVacationsProblems.size() > 0}
			<p>Sono stati riscontrati errori durante il calcolo dei piani
				ferie per le seguenti persone:</p>
			<ul>
				#{list items:contractsWithVacationsProblems, as:'contract'}
				<li><a href="@{Persons.edit(contract.person.id)}">Contratto
						di ${contract.person.surname} ${contract.person.name} iniziato il
						${contract.beginDate}</a></li> #{/list}
			</ul>
			<p>Tali errori potrebbero derivare dalla mancanza di dati di
				inizializzazione inerenti il contratto.</p>
			#{/if}

</div>
