#{extends 'main3.html' /} 
#{set header:'navbar' /} 
#{set title: 'ePAS - Ferie e Permessi' /} 

#{set 'moreStyles'}

<style>
/* allineamento centrato dei th con rowspan e colspan */
#tabella-ferie th {
	vertical-align: inherit;
}
</style>

#{/set}

<div class="container">
  
</div>  

<div class="container">

#{tabs}
  #{tabItem id:'remaining', title:'Residui Totali', active:true /}
  #{tabItem id:'feriePrec', title:'Riepilogo Ferie ' + (year-1) /}
  #{tabItem id:'ferieAtt', title:'Riepilogo Ferie ' + (year) /}
  #{tabItem id:'permessi', title:'Riepilogo Permessi '+ (year) /}
  
#{/tabs}

<br>

#{tabContent}

  #{tabContentItem id:'remaining', active:true}
  
  #{title title:('Residui Totali Anno ' + year), administration:true /}
  
  #{alert color:'info'}
    <p>Per verificare i residui maturati navigare le specifiche tabs.</p>
    <p><strong>*</strong> L'asterisco evidenzia che per la persona il residuo deve essere utilizzato
    in un intervallo ridotto rispetto a quello naturale in quanto non interamente contenuto nel contratto.</p>
    
    #{if isVacationLastYearExpired || isVacationCurrentYearExpired || isPermissionCurrentYearExpired }
    <p><span class="glyphicon glyphicon-remove" style="color: red;"></span> Questo simbolo indica che il relativo
    residuo adesso non è più utilizzabile in quanto scaduto.</p>
    #{/if}
    
  #{/alert}
  
  <table  class="table table-striped table-hover table-bordered table-condensed center" datatable width="100%">
	<thead>
		<tr>
		    <th rowspan="2">Nome</th>
		    <th colspan="3">Residui</th>
			<th rowspan="2">Totale</th>
		</tr>	
		<tr>
			<th>Ferie ${year-1} 
				#{if isVacationLastYearExpired}	
				<span class="glyphicon glyphicon-remove" style="color: red;"></span>
				#{/if}
			</th>
			<th>Ferie ${year}
			    #{if isVacationCurrentYearExpired}	
				<span class="glyphicon glyphicon-remove" style="color: red;"></span>
				#{/if}
			</th>
			<th>Permessi ${year}
			    #{if isPermissionCurrentYearExpired}	
				<span class="glyphicon glyphicon-remove" style="color: red;"></span>
				#{/if}
			</th>
		</tr>
	</thead>

	<tbody>
		#{list items:vacationsList, as:'vacationsRecap'}
		<tr>
			<td>${vacationsRecap.vacationsRequest.contract.person.fullname}</td>
		
			<!-- residui totali -->

			<!-- ferie anno precedente -->
			<td>
			<a
				href="@{VacationsAdmin.vacationsLastYear(vacationsRecap.vacationsRequest.contract.id, 
				    vacationsRecap.vacationsRequest.year)}"
				data-async-modal="#defaultModal">
					${vacationsRecap.vacationsLastYear.notYetUsedTotal}
			</a>
			#{if vacationsRecap.vacationsLastYear.contractLowerLimit 
			     || vacationsRecap.vacationsLastYear.contractUpperLimit }
			<strong>*</strong>
			#{/if}     
			
			</td>
			
			<!-- ferie anno corrente -->
			<td>
			<a
				href="@{VacationsAdmin.vacationsCurrentYear(vacationsRecap.vacationsRequest.contract.id, 
				    vacationsRecap.vacationsRequest.year)}"
				data-async-modal="#defaultModal">
					${vacationsRecap.vacationsCurrentYear.notYetUsedTotal}
			</a>
			#{if vacationsRecap.vacationsCurrentYear.contractLowerLimit 
			     || vacationsRecap.vacationsCurrentYear.contractUpperLimit }
			<strong>*</strong>
			#{/if}     
			
			</td>
			
			<!-- permessi anno corrente -->
			<td>
			<a
				href="@{VacationsAdmin.permissionCurrentYear(vacationsRecap.vacationsRequest.contract.id, 
				    vacationsRecap.vacationsRequest.year)}"
				data-async-modal="#defaultModal">
					${vacationsRecap.permissions.notYetUsedTotal}
			</a>
			#{if vacationsRecap.permissions.contractLowerLimit 
			     || vacationsRecap.permissions.contractUpperLimit }
			<strong>*</strong>
			#{/if}     
			
			
			</td>

			<td>
			   ${vacationsRecap.vacationsLastYear.notYetUsedTotal 
			   + vacationsRecap.vacationsCurrentYear.notYetUsedTotal 
			   + vacationsRecap.permissions.notYetUsedTotal}
			</td>
			
		</tr>
		#{/list}

	</tbody>
  </table>
  #{/tabContentItem}
  
  #{tabContentItem id:'ferieAtt'}
  
  #{title title:('Situazione Ferie anno ' + year), administration:true /}
  
  #{alert color:'info'}
    <p>Nella cella <strong>Prendibili</strong> per i tempi determinati vengono considerati solo i giorni
    maturati mentre per i tempi indeterminati vengono considerati i giorni totali rimanenti.</p>
    #{if isVacationCurrentYearExpired}
    <p><span class="glyphicon glyphicon-remove" style="color: red;"></span> Questo simbolo indica che il relativo
    residuo adesso non è più utilizzabile in quanto scaduto.</p>
    #{/if}
  #{/alert}
  
  <table  class="table table-striped table-hover table-bordered table-condensed center" datatable width="100%">
	<thead>
		<tr>
		    <th rowspan="2">Nome</th>
		    <th rowspan="2">Totali</th>
			<th rowspan="2">Maturate</th>
			<th rowspan="2">Usate</th>
			<th colspan="2">Rimanenti</th>
		    <th colspan="2">Limiti Utilizzo</th>
		</tr>	
		<tr>
		    <th>Prendibili
		    #{if isVacationCurrentYearExpired}
    			<span class="glyphicon glyphicon-remove" style="color: red;"></span>
    		#{/if}
    		</th>
		    <th>Totali</th>
		    <th>Iniziale</th>
			<th>Finale</th>
		</tr>
	</thead>

	<tbody>
		#{list items:vacationsList, as:'vacationsRecap'}
		<tr>
		    <td>
				<a
				href="@{VacationsAdmin.vacationsCurrentYear(vacationsRecap.vacationsRequest.contract.id, 
				    vacationsRecap.vacationsRequest.year)}"
				data-async-modal="#defaultModal">
					${vacationsRecap.vacationsRequest.contract.person.fullname}</a>
			</td>
			
			<td>${vacationsRecap.vacationsCurrentYear.total}</td>
			<td>${vacationsRecap.vacationsCurrentYear.accrued}</td>
			<td>${vacationsRecap.vacationsCurrentYear.used}</td>
			
			<!-- residui totali -->
			<td>${vacationsRecap.vacationsCurrentYear.notYetUsedTakeable}</td>
  		    <td>${vacationsRecap.vacationsCurrentYear.notYetUsedTotal}</td>
				
			<!-- limiti utilizzo -->	
			#{if vacationsRecap.vacationsCurrentYear.contractLowerLimit}
			  <td><em><strong>${vacationsRecap.vacationsCurrentYear.lowerLimit.format()}</strong></em></td>
			#{/if} #{else}
			  <td class="text-muted">${vacationsRecap.vacationsCurrentYear.lowerLimit.format()}</td>
			#{/else}	
			
			#{if vacationsRecap.vacationsCurrentYear.contractUpperLimit}
			  <td><em><strong>${vacationsRecap.vacationsCurrentYear.upperLimit.format()}</strong></em></td>
			#{/if} #{else}
			  <td class="text-muted">${vacationsRecap.vacationsCurrentYear.upperLimit.format()}</td>
			#{/else}	

		</tr>
		#{/list}

	</tbody>
  </table>
  #{/tabContentItem}
  
  
   #{tabContentItem id:'permessi'}
   
   #{title title:('Situazione Permessi anno ' + year), administration:true /}
   
    #{alert color:'info'}
	    <p>Nella cella <strong>Prendibili</strong> per i tempi determinati vengono considerati solo i giorni
	    maturati mentre per i tempi indeterminati vengono considerati i giorni totali rimanenti.</p>
	    #{if isPermissionCurrentYearExpired}
	    <p><span class="glyphicon glyphicon-remove" style="color: red;"></span> Questo simbolo indica che il relativo
	    residuo adesso non è più utilizzabile in quanto scaduto.</p>
	    #{/if}
    #{/alert}
  
  
  <table  class="table table-striped table-hover table-bordered table-condensed center" datatable width="100%">
	<thead>
		<tr>
		    <th rowspan="2">Nome</th>
		    <th rowspan="2">Totali</th>
			<th rowspan="2">Maturate</th>
			<th rowspan="2">Usate</th>
			<th colspan="2">Rimanenti</th>
		    <th colspan="2">Limiti Utilizzo</th>
		</tr>	
		<tr>
		    <th>Prendibili
		      #{if isPermissionCurrentYearExpired}
	    		<span class="glyphicon glyphicon-remove" style="color: red;"></span>
	    	  #{/if}	
		    </th>
		    <th>Totali</th>
		    <th>Iniziale</th>
			<th>Finale</th>
		</tr>
	</thead>

	<tbody>
		#{list items:vacationsList, as:'vacationsRecap'}
		<tr>
		    <td>
				<a
				href="@{VacationsAdmin.permissionCurrentYear(vacationsRecap.vacationsRequest.contract.id, 
				    vacationsRecap.vacationsRequest.year)}"
				data-async-modal="#defaultModal">
					${vacationsRecap.vacationsRequest.contract.person.fullname}</a>
			</td>
			
			<td>${vacationsRecap.permissions.total}</td>
			<td>${vacationsRecap.permissions.accrued}</td>
			<td>${vacationsRecap.permissions.used}</td>
			
			<!-- residui totali -->
			<td>${vacationsRecap.permissions.notYetUsedTakeable}</td>
  		    <td>${vacationsRecap.permissions.notYetUsedTotal}</td>
				
			<!-- limiti utilizzo -->	
			#{if vacationsRecap.permissions.contractLowerLimit}
			  <td><em><strong>${vacationsRecap.permissions.lowerLimit.format()}</strong></em></td>
			#{/if} #{else}
			  <td class="text-muted">${vacationsRecap.permissions.lowerLimit.format()}</td>
			#{/else}	
			
			#{if vacationsRecap.permissions.contractUpperLimit}
			  <td><em><strong>${vacationsRecap.permissions.upperLimit.format()}</strong></em></td>
			#{/if} #{else}
			  <td class="text-muted">${vacationsRecap.permissions.upperLimit.format()}</td>
			#{/else}	


		</tr>
		#{/list}

	</tbody>
  </table>
  
  #{/tabContentItem}
  
  #{tabContentItem id:'feriePrec'}
  #{title title:('Situazione Ferie anno ' + (year-1)), administration:true /}
  
  #{alert color:'info'}
    <p>Nella cella <strong>Prendibili</strong> per i tempi determinati vengono considerati solo i giorni
    maturati mentre per i tempi indeterminati vengono considerati i giorni totali rimanenti.</p>
    #{if isVacationLastYearExpired}
    <p><span class="glyphicon glyphicon-remove" style="color: red;"></span> Questo simbolo indica che il relativo
    residuo adesso non è più utilizzabile in quanto scaduto.</p>
    #{/if}
  #{/alert}
  
  <table  class="table table-striped table-hover table-bordered table-condensed center" datatable width="100%">
	<thead>
		<tr>
		    <th rowspan="2">Nome</th>
		    <th rowspan="2">Totali</th>
			<th rowspan="2">Maturate</th>
			<th rowspan="2">Usate</th>
			<th colspan="2">Rimanenti</th>
		    <th colspan="2">Limiti Utilizzo</th>
		</tr>	
		<tr>
		    <th>Prendibili
		    #{if isVacationLastYearExpired}
    			<span class="glyphicon glyphicon-remove" style="color: red;"></span>
            #{/if}
		    </th>
		    <th>Totali</th>
		    <th>Iniziale</th>
			<th>Finale</th>
		</tr>
	</thead>

	<tbody>
		#{list items:vacationsList, as:'vacationsRecap'}
		<tr>
		    <td>
				<a
				href="@{VacationsAdmin.vacationsLastYear(vacationsRecap.vacationsRequest.contract.id, 
				    vacationsRecap.vacationsRequest.year)}"
				data-async-modal="#defaultModal">
					${vacationsRecap.vacationsRequest.contract.person.fullname}</a>
			</td>
			
			<td>${vacationsRecap.vacationsLastYear.total}</td>
			<td>${vacationsRecap.vacationsLastYear.accrued}</td>
			<td>${vacationsRecap.vacationsLastYear.used}</td>
			
			<!-- residui totali -->
			<td>${vacationsRecap.vacationsLastYear.notYetUsedTakeable}</td>
  		    <td>${vacationsRecap.vacationsLastYear.notYetUsedTotal}</td>
				
			<!-- limiti utilizzo -->	
			#{if vacationsRecap.vacationsLastYear.contractLowerLimit}
			  <td><em><strong>${vacationsRecap.vacationsLastYear.lowerLimit.format()}</strong></em></td>
			#{/if} #{else}
			  <td class="text-muted">${vacationsRecap.vacationsLastYear.lowerLimit.format()}</td>
			#{/else}	
			
			#{if vacationsRecap.vacationsLastYear.contractUpperLimit}
			  <td><em><strong>${vacationsRecap.vacationsLastYear.upperLimit.format()}</strong></em></td>
			#{/if} #{else}
			  <td class="text-muted">${vacationsRecap.vacationsLastYear.upperLimit.format()}</td>
			#{/else}	

		</tr>
		#{/list}

	</tbody>
  </table>
  #{/tabContentItem}

#{/tabContent}


*{


			<p>
				<br> #{if isVacationLastYearExpired} <span
					class="glyphicon glyphicon-remove" style="color: red;"></span>
				Ferie anno precedente scadute. #{/if} #{else} <span
					class="glyphicon glyphicon-ok" style="color: green;"></span> Ferie
				anno precedente utilizzabili. #{/else}
			</p>

			#{if contractsWithVacationsProblems.size() > 0}
			<p>Sono stati riscontrati errori durante il calcolo dei piani
				ferie per le seguenti persone:</p>
			<ul>
				#{list items:contractsWithVacationsProblems, as:'contract'}
				<li><a href="@{Persons.edit(contract.person.id)}">Contratto
						di ${contract.person.surname} ${contract.person.name} iniziato il
						${contract.beginDate}</a></li> #{/list}
			</ul>
			<p>Tali errori potrebbero derivare dalla mancanza di dati di
				inizializzazione inerenti il contratto.</p>
			#{/if}
  }*
</div>
