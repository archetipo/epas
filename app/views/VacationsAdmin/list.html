#{extends 'main3.html' /} #{set header:'navbar' /} 
#{set title: 'ePAS - Ferie e Permessi' /} 

#{set 'moreStyles'}

<style>
/* allineamento centrato dei th con rowspan e colspan */
#tabella-ferie th {
	vertical-align: inherit;
}
</style>

#{/set}

#{set breadcrumbs:['Ferie E Permessi':null] /}
 
<div class="container">
  #{breadcrumbs breadcrumbs /}
  #{title title:'Ferie e Permessi ' + year, administration:true /}
</div>  

<div class="container-fluid">

	<table 	class="table table-striped table-hover table-bordered table-condensed" datatable width="100%">
				<thead>
					<tr>
						<th>Nome</th>
						<th>Ferie Fatte ${year-1}</th>
						<th>Ferie Fatte ${year}</th>
						<th>Permessi Fatti ${year}</th>
						<th>Ferie ${year-1}<br> #{if isVacationLastYearExpired}<span
							class="glyphicon glyphicon-remove" style="color: red;"></span>#{/if}
							#{else}<span class="glyphicon glyphicon-ok" style="color: green;"></span>#{/else}
						</th>
						<th>Ferie ${year}<br>Residue Totali
						</th>
						<th>Ferie ${year}<br>Residue Maturate
						</th>
						<th>Permessi<br>Residui Totali
						</th>
						<th>Permessi<br>Residui Maturati
						</th>
						<th>Limite <br>Iniziale
						</th>
						<th>Limite <br>Finale
						</th>
					</tr>
				</thead>

				<tbody>
					#{list items:vacationsList, as:'vacationsRecap'}
					<tr>
						<!-- ferie e permessi fatti -->
						<td>${vacationsRecap.person.surname}
							${vacationsRecap.person.name}</td>

						<td data-order="${vacationsRecap.vacationDaysLastYearUsed}">
							<a
							href="@{VacationsAdmin.vacationsLastYear(vacationsRecap.contract.id, vacationsRecap.year)}"
							data-async-modal="#defaultModal">
								${vacationsRecap.vacationDaysLastYearUsed} </a>
						</td>

						<td data-order="${vacationsRecap.vacationDaysCurrentYearUsed}">
							<a
							href="@{VacationsAdmin.vacationsCurrentYear(vacationsRecap.contract.id, vacationsRecap.year)}"
							data-async-modal="#defaultModal">
								${vacationsRecap.vacationDaysCurrentYearUsed} </a>
						</td>

						<td data-order="${vacationsRecap.permissionUsed}"><a
							href="@{VacationsAdmin.permissionCurrentYear(vacationsRecap.contract.id, vacationsRecap.year)}"
							data-async-modal="#defaultModal"> ${vacationsRecap.permissionUsed} </a></td>

						<!-- residui -->

						<!-- ferie 2013 -->
						<td>${vacationsRecap.vacationDaysLastYearNotYetUsed}</td>

						<!-- ferie 2014 -->
						<td>${vacationsRecap.vacationDaysCurrentYearTotal -
							vacationsRecap.vacationDaysCurrentYearUsed}</td>
						<td>${vacationsRecap.vacationDaysCurrentYearAccrued -
							vacationsRecap.vacationDaysCurrentYearUsed}</td>

						<!-- permessi 2014 -->
						<td>${vacationsRecap.permissionCurrentYearTotal -
							vacationsRecap.permissionUsed}</td>
						<td>${vacationsRecap.permissionCurrentYearAccrued -
							vacationsRecap.permissionUsed}</td>

						<td>#{if vacationsRecap.isActiveAfterBeginYear } <span
							class="badge badge-success">${vacationsRecap.activeContractInterval.getBegin()}</span>
							#{/if}
						</td>

						<td>#{if vacationsRecap.isExpireBeforeEndYear } <span
							class="badge badge-important">${vacationsRecap.activeContractInterval.getEnd()}</span>
							#{/if}
						</td>

					</tr>
					#{/list}

				</tbody>
			</table>





			<p>
				<br> #{if isVacationLastYearExpired} <span
					class="glyphicon glyphicon-remove" style="color: red;"></span>
				Ferie anno precedente scadute. #{/if} #{else} <span
					class="glyphicon glyphicon-ok" style="color: green;"></span> Ferie
				anno precedente utilizzabili. #{/else}
			</p>

			#{if contractsWithVacationsProblems.size() > 0}
			<p>Sono stati riscontrati errori durante il calcolo dei piani
				ferie per le seguenti persone:</p>
			<ul>
				#{list items:contractsWithVacationsProblems, as:'contract'}
				<li><a href="@{Persons.edit(contract.person.id)}">Contratto
						di ${contract.person.surname} ${contract.person.name} iniziato il
						${contract.beginContract}</a></li> #{/list}
			</ul>
			<p>Tali errori potrebbero derivare dalla mancanza di dati di
				inizializzazione inerenti il contratto.</p>
			#{/if}

</div>
