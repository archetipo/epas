#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Gestione sede'  /}

#{set breadcrumbs:['badgeReaders':@BadgeReaders.list(), ('Configura '+ badgeReader.code):null] /}
 
<div class="container">

  #{breadcrumbs breadcrumbs, noHome:'true' /}
  
#{tabs}
  #{tabItem id:'info', title:'Riepilogo', active:true /}
  #{tabItem id:'badgeSystems', title:'badgeSystems' /}
#{/tabs}
<br>
#{tabContent}

  #{tabContentItem id:'info', active:true}
    #{panel title:'Informazioni', color:'primary'}
  	  <div class="alert alert-info" role="alert">
    	Modifica i dati della &{'badgeReader'} <strong>${badgeReader.code}</strong>
      </div>
		#{form action:@updateInfo(), method:'POST', autocomplete:false,
		    class:'form form-horizontal' }			

		  #{f.hidden 'badgeReader.id' /}				
		  #{f.input 'badgeReader.code', required:true /}
	      #{f.input 'badgeReader.description' /}
	      #{f.input 'badgeReader.location' /}
	    
	      #{f.selectModel 'badgeReader.owner', items:templateUtility.officeForBadgeReaders(), required:true /}
 	  	
	      #{b.buttons}
	        #{b.save /}
	      #{/b.buttons}
		#{/form}
	  #{/panel}
      
      #{panel title:'Nuova Password', color:'primary'}
  	  <div class="alert alert-danger" role="alert">
    	Modifica la password di accesso della &{'badgeReader'} <strong>${badgeReader.code}</strong>
      </div>
		#{form action:@changePassword(badgeReader.id), method:'POST', autocomplete:false,
		    class:'form form-horizontal' }
			

		  #{f.hidden 'user.id', value:badgeReader.user.id /}				
		  #{f.view 'badgeReader.user.username' /}
	  	  #{f.input 'newPass', type:'password', label:'Nuova password' /} 
	
	      #{b.buttons}
	        #{b.save /}
	      #{/b.buttons}
		#{/form}
    #{/panel}
  
  #{/tabContentItem}
  
  #{tabContentItem id:'badgeSystems'}
    
    
    
    *{ TODO il target }*
    #{secure.checkAction 'BadgeReaders.joinBadgeSystems'}
	   <div class="text-center">
	    <a class="btn btn-success" href="@{joinBadgeSystems(badgeReader.id)}" data-async-modal="#defaultModal">
	      &{'BadgeReaders.joinBadgeSystems'} ${badgeReader.code}
	    </a>
       </div>
       <br>
    #{/secure.checkAction}
    
    #{alert color:'info'}
      <p>La lista dei <strong><i class="fa fa-credit-card"></i><i class="fa fa-credit-card"></i><i class="fa fa-credit-card"></i> &{'badgeSystems'}</strong> attualmente associati a <strong>${badgeReader.code}</strong>.</p>
    #{/alert}
    
    <section id="results">
    #{paginate results} 
	   <ul class="list-group">
	   #{list items:results.results, as:'item'}
	   
		 <li class="list-group-item list-group-item-grey">
		   #{badgeSystem.item item:item /}
	     </li>
	    
	   #{/list}
	   </ul>
    #{/paginate} 
    </section> 
    
  
  #{/tabContentItem}
#{/tabContent}  
  
  
  
  *{  
  #{if office.persons.empty}
   #{secure.checkAction 'Office.delete', target:office}
    #{accordionGroup 'delete'}
     #{accordionItem 'deleteItem', parent:'delete', title:'Eliminare questa sede', open:false, color:'danger'}
	  <div class="text-danger center">
	    E' possibile eliminare la sede ${office.name} poich√® non ha alcun dipendente inserito.<br>
		<a class="btn btn-danger" href=@{Offices.delete(office.id)}></i>Elimina</a> 
	  </div>
     #{/accordionItem}
    #{/accordionGroup }  
   #{/secure.checkAction}
  #{/if}
  }*

</div>

<div id="modalInsertBadgeReader" class="modal container" tabindex="-1"></div>