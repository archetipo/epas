#{extends 'main3.html' /}
#{set header:'navbar' /}
#{set title: 'ePAS - Invio Attestati'  /}

*{
#{set breadcrumbs:['Invio Attestati':@Persons.list()] /}
#{breadcrumbs breadcrumbs, noHome:true, container:true /}
}*

<div class="container">

	#{title title:('Invio Attestati per la sede ' + office.name), administration:true /}
	
	*{
	#{alert color:'primary'}
	  <p>Questa sezione di ePAS mette a disposizione delle procedure automatizzate di caricamento
	  situazioni mensili del personale sul portale <em>Cnr Attestati</em>.</p>
	#{/alert}
	}*
	
	#{panel color:'primary', title:'Popolamento diretto Form Attestati (Richiede login LDAP)'}
	#{form @UploadSituation.processAttestati(), class:'form-horizontal'}
		
		#{alert color:'info'}
		<p>Utilizzare questa procedura per popolare direttamente tramite ePAS le form presenti 
		in <strong>CNR Attestati</strong>.
		</p>
		<ul>
		  	<li>Per ogni persona di cui vanno trasmesse le assenze e competenze, effettua una funzione "Elabora dati" dell'attestato della persona.</li>
		  	<li>La procedura riporta la lista dei risultati della "Elabora dati" di ogni persona e permette di correggere gli eventuali errori manualmente.</li>
		</ul>
		#{/alert}
		
		#{alert color:'danger'}
		<p class="text-danger"><strong>Importante</strong></p>
		<p class="text-danger">Prima di effettuare questa operazione è necessario effettuare lo stralcio dati sul sistema dell'amministrazione centrale del CNR.<br>
		    Lo stralcio dati aggiorna l'elenco del personale tra i database dell'amministrazione centrale ed è richiesta, almeno una volta per ogni mese, 
			dalle procedure dell'amministrazione centrale per la gestione elettronica degli attestati di presenza.
		</p>
		#{/alert}
	
	     #{f.hidden 'office.id'/}
	
		 #{f.selectEnum 'year', label:yearAtt, items:years, value:previousYearMonth.year, byEquals:true, required:true /} 
		 
		 #{f.selectEnum 'month', label:monthAtt, items:months, value:previousYearMonth.monthOfYear, byEquals:true, required:true /}		
		
		 #{if loginResponse==null || !loginResponse.isLoggedIn() }
		   #{f.input 'attestatiLogin', required:true /}
		   #{f.input 'attestatiPassword', type:'password', required:true /}
		   <div class="center">	
		    <input type="submit" value="Login attestati" class="btn-primary"/>
	       </div>
		 #{/if}
 	     #{else}
 	      <div class="center">	
		    <input type="submit" value="Seleziona Mese" class="btn-primary"/>
		    <br>
		    <br>
		    <p>Login LDAP attualmente effettuato con username <strong>${loginResponse.usernameCnr}</strong>.
		    
	      </div>
	     #{/else}
	#{/form}
	
	#{/panel}
	
	#{panel color:'primary', title:'Generazione file da caricare manualmente sul portale CNR Attestati'}
	  
	  #{form @UploadSituation.createFile(), class:'form-horizontal'}
		
		#{f.hidden 'office.id'/}
		
		
		#{alert color:'info'}
		<p>Utilizzare questa procedura per generare un file contenente le informazioni 
		da caricare in <strong>CNR Attestati</strong>.
		</p>
		<p>Scegli <strong>anno</strong> e <strong>mese</strong> di assenze e competenze per i quali vuoi popolare
		 il file da inviare agli attestati di presenza</p>
		#{/alert}

		#{f.selectEnum 'year', label:yearAtt, items:years, value:previousYearMonth.year, byEquals:true /} 
		 
		#{f.selectEnum 'month', label:monthAtt, items:months, value:previousYearMonth.monthOfYear, byEquals:true /}	

		<br>
		<div class="center">
			<input type="submit" value="Crea File" class="btn-primary"/>
		</div>
	#{/form}
	
	
	#{/panel}

</div>
